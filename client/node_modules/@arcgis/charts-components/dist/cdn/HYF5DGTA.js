/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
v4.33.19 */
import{a as A,c as k}from"./QJYWZ24Z.js";import{a as c,b as h}from"./EHA2DPVG.js";import{a as T}from"./RTYYUXTS.js";import{a as F}from"./NEMZXIB4.js";import i from"./NCOEWMF7.js";import f from"./5NI5R3AO.js";import{a as I}from"./QDODWAYJ.js";import{g as r,m as u}from"./ITSRCSFZ.js";import e from"./PDDPZQ7S.js";import{A as a,E as O,c as x,d as l,f as B,n as b,z as P}from"./MDSKC43G.js";import{a as n}from"./TJWJSZZ6.js";import{a as g,b as d}from"./IYCX42AE.js";import"./YG7SBKS5.js";export default $arcgis.t(([,,,,,,,{A:f,Jc:S,Tb:y,bb:w,kb:v,o:C,tb:p,ub:L},{a:D},{a:E,b:N,c:_}])=>{var o={label:"label",fieldList:"field-list",fab:"fab",disabledLabel:"disabled-label",list:"list",customSortButtons:"custom-sort-buttons",dimText:"dim-text"},M=x`.hide{display:none}.am5-modal{width:100%;height:100%;position:absolute;z-index:100000;top:0;left:0}.am5-modal-curtain{top:0;left:0;width:100%;height:100%;position:absolute;background:#fff!important;z-index:100}.am5-modal-wrapper{top:0;left:0;width:100%;height:100%;position:absolute;display:flex;align-items:center;justify-content:center;white-space:nowrap;background:#ffffff80;z-index:101}.am5-modal-content{display:inline-block;padding:1.2em;vertical-align:middle;text-align:start;white-space:normal;background:#fff;border-radius:4px;box-shadow:#00000073 0 0 36px;color:#000}.am5-layer-1000{z-index:1000!important}.arcgis-charts-modal{box-shadow:none!important}.arcgis-charts-modal-header{background-color:#0000000d;font-weight:700;padding:4px;align-content:center}.show{display:block}.notifyPanel{flex:0 1 auto}.disable-interactions{pointer-events:none}.dim-text{color:var(--arcgis-charts-dim-text)}:host{display:flex;flex-direction:column;width:var(--arcgis-charts-config-calcite-block-default-width);margin:var(--arcgis-charts-config-calcite-block-default-margin);margin-top:var(--arcgis-charts-top-section-margin)}.label,.disabled-label{display:flex;margin-left:var(--arcgis-charts-config-margin-minor);margin-right:var(--arcgis-charts-config-margin-minor);margin-bottom:var(--arcgis-charts-config-margin-minor);justify-content:space-between}.text{display:flex;margin-left:var(--arcgis-charts-config-margin-minor);width:calc(100% - 1.5rem);height:2rem;margin-bottom:var(--arcgis-charts-config-margin-minor);justify-content:space-between}.field-list{max-height:50vh;overflow-y:auto}.disabled-label{pointer-events:none}.fab{display:flex;margin-left:var(--arcgis-charts-config-margin-minor);margin-right:var(--arcgis-charts-config-margin-minor);margin-bottom:1.5rem;justify-content:center}.list{margin-left:var(--arcgis-charts-config-margin-minor);margin-right:var(--arcgis-charts-config-margin-minor);margin-bottom:var(--arcgis-charts-config-margin-major)}.custom-sort-buttons{display:flex;justify-content:space-between;align-items:center;font-weight:var(--calcite-font-weight-medium);font-size:var(--calcite-font-size-0)}`,$=class extends P{constructor(){super(...arguments),this._messages=I(),this.barChartPopover=null,this.sortOrderElement=c(),this.aggregationElement=c(),this.categoryElement=c(),this.numericFieldsElement=c(),this.splitByFieldElement=c(),this.originalCustomSortLabels=[],this.isCustomSortDisabled=!1,this.onBarChartDataChange=async e=>{try{if(e.detail!==null&&e.detail?.value!==void 0){let{contentKind:i}=e.detail,t=[...e.detail.value];switch(k(A),i){case r.aggregation:await this.model.setAggregationType(t[0]!==d.NoAggregation?t[0]:d.NoAggregation);break;case r.category:{let s=t[0]?.trim()||"";if(await this.model.setXAxisField(s),this.model.getSortOrder()===n.customSort){let m=await this.updateCustomSortProps();this.model.setOrderByList(m),this.sortOrderResetCounter+=1}break}case r.numericFields:if(await this.model.setNumericFields(t),(this.model.getNumericFields()??[]).length>0&&this.model.getAggregationType()===d.Count&&this.model.getNumericFields()[0]!==S(this.layerFieldsInfo)&&await this.model.setAggregationType(d.Sum),this.model.getSortOrder()===n.customSort){let s=await this.updateCustomSortProps();this.model.setOrderByList(s),this.sortOrderResetCounter+=1}break;case r.splitByField:{let s=t[0]?.trim()||"";await this.model.setSplitByField(s),this.model.setColorMatch(!0);break}case r.sortOrder:{let s=t[0];if(s===n.customSort){let m=await this.updateCustomSortProps();this.model.setSortOrder(s,m)}else this.model.setSortOrder(s);this.sortOrderResetCounter+=1;break}default:break}}}catch(i){throw this.arcgisChartsConfigDataChangeError.emit({error:i,model:this.model}),i}this.removeBarChartDataPopover(),this.requestUpdate()},this.onModelConfigChange=()=>{this.requestUpdate()},this.popoverClose=e=>{this.barChartPopover===e?.target&&this.removeBarChartDataPopover()},this.selectedCustomSortItemId="",this.sortOrderResetCounter=0,this.layerFieldsInfo=[],this.arcgisChartsConfigBarChartDataNumericFieldValidate=b(),this.arcgisChartsConfigDataChangeError=b()}static{this.properties={selectedCustomSortItemId:16,aggregationLabel:16,disableSplitBy:16,sortOrderResetCounter:16,messageOverrides:0,model:0,layerFieldsInfo:0,open:7}}static{this.styles=M}load(){this.modelChange(this.model),this.onModelConfigChange(),this.currentDataFilter=this.model.getDataFilter(),this.updateCustomSortProps()}async willUpdate(e){e.has("model")&&this.modelChange(this.model,e.get("model")),this.aggregationLabel=await w(this.model.getAggregationType()),f(this.model.getDataFilter(),this.currentDataFilter)||(this.model.getSortOrder()===n.customSort&&await this.updateCustomSortProps(),this.currentDataFilter=this.model.getDataFilter()),this.disableSplitBy=this.model.getNumericFields().length>1||this.model.getXAxisField()===""||this.model.getXAxisField()===C}disconnectedCallback(){super.disconnectedCallback(),this.removeBarChartDataPopover(),this.model.removeEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)}modelChange(e,i){i?.removeEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange),e?.addEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)}onCalciteListOrderChange(e){if(e.detail!==null&&e.detail!==void 0){let{newIndex:i,oldIndex:t}=e.detail;this.model.moveCustomSortValuesInOrderByList(t,i)}}onCustomSortItemSelected(e){let{id:i}=e.target;this.selectedCustomSortItemId=this.selectedCustomSortItemId===i?"":i}onCustomSortItemMoved(e){let{id:i}=e.target,t=this.model.getOrderByList().length,s=this.model.getOrderByList().indexOf(this.selectedCustomSortItemId);i===u.Up?t=s-1:i===u.Down&&(t=s+1),s>=0&&t>=0&&t<this.model.getOrderByList().length&&(this.model.moveCustomSortValuesInOrderByList(s,t),this.sortOrderResetCounter+=1)}buildNumericFieldItem(e){return F(e,l`<calcite-list-item .label=${p(this.layerFieldsInfo,e)} .value=${e} closable @calciteListItemClose=${this.onRemoveNumericField}></calcite-list-item>`)}buildCustomSortListItems(){return T(this.model.getOrderByList(),e=>e,e=>{let i=L(this.layerFieldsInfo,e);return l`<calcite-list-item id=${e??B} .label=${e} .description=${i} .value=${e} .selected=${this.selectedCustomSortItemId===e} @calciteListItemSelect=${this.onCustomSortItemSelected}><calcite-icon slot=content-end></calcite-icon></calcite-list-item>`})}buildCustomSortList(){return F(this.sortOrderResetCounter,l`<calcite-list label class=${a(o.list)} drag-enabled selection-mode=single selection-appearance=border @calciteListOrderChange=${this.onCalciteListOrderChange}>${this.buildCustomSortListItems()}</calcite-list>`)}onAggregationSelect(){this.contentKind=r.aggregation,this.setupPopover()}onSortOrderSelect(){this.contentKind=r.sortOrder,this.setupPopover()}onCategorySelect(){this.contentKind=r.category,this.setupPopover()}onSplitBySelect(){this.splitByFieldElement.value&&!this.splitByFieldElement.value.disabled&&(this.contentKind=r.splitByField,this.setupPopover())}onAddNumericFields(){this.contentKind=r.numericFields,this.setupPopover()}async onRemoveNumericField(e){let i=e.target.value;if(await this.model.setNumericFields(this.model.getNumericFields().filter(t=>t!==i)),this.model.getSortOrder()===n.customSort){let t=await this.updateCustomSortProps();this.model.setOrderByList(t),this.sortOrderResetCounter+=1}}getCorrectedSplitByValue(){return this.model.getSplitByField()===""||(this.model.getNumericFields()??[]).length>1?"":p(this.layerFieldsInfo,this.model.getSplitByField())}getCorrectedCategoryValue(){return this.model.getXAxisField()===C||this.model.getXAxisField().trim()===""?"":p(this.layerFieldsInfo,this.model.getXAxisField())}onShowDataLabelsChange(e){this.model.setDataLabelsVisibility(e.target.checked)}async updateCustomSortProps(){let e=await this.model.getCustomSortValues();this.originalCustomSortLabels=[...e];let i=e.length>D.customSortLimit;return i&&(this.sortOrderElement.value&&(this.sortOrderElement.value.label=this._messages.xAxisAsc),this.model.setSortOrder(n.xAxisAsc)),this.isCustomSortDisabled=i,e}setupPopover(){this.removeBarChartDataPopover();let e={layerFieldsInfo:this.layerFieldsInfo,onBarChartDataChange:this.onBarChartDataChange,popoverClose:this.popoverClose};if(this.barChartPopover=_(E.BarChartDataPopover,e),this.barChartPopover!==null){switch(this.contentKind){case r.aggregation:this.barChartPopover.referenceElement=this.aggregationElement.value,this.barChartPopover.headingTitle=this._messages.aggregationHeader,this.barChartPopover.isNoAggregationDisabled=y(this.model.getConfig().series??[])===v.BarAndLineFromFields,this.barChartPopover.selectedContent=this.model.getAggregationType();break;case r.category:this.barChartPopover.referenceElement=this.categoryElement.value,this.barChartPopover.headingTitle=this._messages.categoryHeader,this.barChartPopover.selectedContent=this.model.getXAxisField();break;case r.numericFields:this.barChartPopover.referenceElement=this.numericFieldsElement.value,this.barChartPopover.headingTitle=this._messages.numericFieldsHeader,this.barChartPopover.selectedContent=this.model.getNumericFields();break;case r.splitByField:this.barChartPopover.referenceElement=this.splitByFieldElement.value,this.barChartPopover.headingTitle=this._messages.splitByFieldHeader,this.barChartPopover.selectedContent=this.model.getSplitByField();break;case r.sortOrder:this.barChartPopover.referenceElement=this.sortOrderElement.value,this.barChartPopover.headingTitle=this._messages.sortOrderHeader,this.barChartPopover.selectedContent=this.model.getSortOrder(),this.barChartPopover.isCustomSortDisabled=this.isCustomSortDisabled;break}this.barChartPopover.contentKind=this.contentKind,this.barChartPopover.open=!0,this.addPopover()}}addPopover(){!document.body.contains(this.barChartPopover)&&this.barChartPopover!==null&&document.body.appendChild(this.barChartPopover)}removeBarChartDataPopover(){this.barChartPopover!==null&&(this.barChartPopover.open=!1,this.barChartPopover=N(this.barChartPopover))}resetToOriginalCustomSortLabels(){this.selectedCustomSortItemId="",this.model.setOrderByList([...this.originalCustomSortLabels]),this.sortOrderResetCounter+=1}renderSorting(){return l`<arcgis-charts-config-field-select .disabled=${this.model.getXAxisValueFormat()?.type===g.DateAxisFormat} .label=${this.model.getXAxisValueFormat()?.type===g.DateAxisFormat?this._messages.xAxisAsc:this._messages[this.model.getSortOrder()]} @click=${this.onSortOrderSelect} ${h(this.sortOrderElement)}></arcgis-charts-config-field-select>`}renderAggregation(){return l`<arcgis-charts-config-field-select .label=${this.model.getAggregationType()===d.NoAggregation?this._messages.noAggregation:this.aggregationLabel} @click=${this.onAggregationSelect} ${h(this.aggregationElement)}></arcgis-charts-config-field-select>`}renderCategory(){let e=this.getCorrectedCategoryValue();return l`<arcgis-charts-config-field-select .label=${e} @click=${this.onCategorySelect} ${h(this.categoryElement)}></arcgis-charts-config-field-select>`}renderSplitBy(){let e=this.getCorrectedSplitByValue();return l`<arcgis-charts-config-field-select .label=${e} .disabled=${this.disableSplitBy} @click=${this.onSplitBySelect} ${h(this.splitByFieldElement)}></arcgis-charts-config-field-select>`}renderNumericFields(e){let i=S(this.layerFieldsInfo),t=[];for(let s of e)s!==i&&t.push(this.buildNumericFieldItem(s));return l`<calcite-list label class=${a(o.fieldList)} ${h(this.numericFieldsElement)}>${t}</calcite-list>`}renderCustomSortUI(){let e=this.model.getSortOrder(),i=this.model.getXAxisValueFormat()?.type,t=this.model.getOrderByList().indexOf(this.selectedCustomSortItemId);return i===g.CategoryAxisFormat&&e===n.customSort&&!this.isCustomSortDisabled?l`<calcite-label class=${a(o.label)}><div class=${a(o.customSortButtons)}><div><calcite-button appearance=transparent .disabled=${t===0||t===-1||this.selectedCustomSortItemId.trim()===""} icon-start=arrow-bold-up id=${u.Up} kind=neutral scale=s @click=${this.onCustomSortItemMoved}></calcite-button><calcite-button appearance=transparent .disabled=${t===-1||t===this.model.getOrderByList().length-1||this.selectedCustomSortItemId.trim()===""} icon-start=arrow-bold-down id=${u.Down} kind=neutral scale=s @click=${this.onCustomSortItemMoved}></calcite-button></div><calcite-button @click=${this.resetToOriginalCustomSortLabels} .disabled=${f(this.model.getOrderByList(),this.originalCustomSortLabels)} appearance=transparent icon-end=reset>${this._messages.reset}</calcite-button></div>${y(this.model.getConfig().series??[])===v.BarAndLineFromFields?this._messages.values:this._messages.category}${this.buildCustomSortList()}</calcite-label>`:null}render(){let e=this.renderAggregation(),i=this.renderCategory(),t=this.renderSplitBy(),s=this.renderSorting(),m=this.renderNumericFields([...this.model.getNumericFields()??[]]),V=this.renderCustomSortUI();return l`<div><calcite-label class=${a(o.label)}>${this._messages.category}${i}</calcite-label><calcite-label class=${a(o.label)}>${this._messages.aggregation}${e}</calcite-label><calcite-label class=${a(o.label)}>${this._messages.numericFields}${m}</calcite-label><div class=${a(o.fab)}><calcite-fab appearance=outline-fill kind=neutral scale=m .label=${this._messages.selectNumericFields} text-enabled .text=${this._messages.selectNumericFields} icon=plus @click=${this.onAddNumericFields}></calcite-fab></div><calcite-label class=${a(o.label)}><span class=${a(this.disableSplitBy?o.dimText:"")}>${this._messages.splitBy}</span>${t}</calcite-label><calcite-label class=${a(o.label)} layout=inline-space-between>${this._messages.showDataLabels}<calcite-switch .checked=${this.model.getDataLabelsVisibility()} @calciteSwitchChange=${this.onShowDataLabelsChange}></calcite-switch></calcite-label><calcite-label class=${a(this.model.getXAxisValueFormat()?.type===g.DateAxisFormat?o.disabledLabel:o.label)}>${this._messages.sortOrder}${s}</calcite-label>${V}</div>`}};O("arcgis-charts-config-bar-chart-data",$);return $},"geometry/support/jsonUtils","rest/support/AttributeBinsQuery","rest/support/Query","rest/support/StatisticDefinition","time/TimeExtent","core/promiseUtils","request",e,f,i)