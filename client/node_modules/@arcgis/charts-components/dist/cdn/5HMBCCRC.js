/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
v4.33.19 */
import{a as c,b as h}from"./EHA2DPVG.js";import{a as F}from"./NEMZXIB4.js";import i from"./NCOEWMF7.js";import{a as P}from"./QDODWAYJ.js";import{h as a}from"./ITSRCSFZ.js";import e from"./PDDPZQ7S.js";import{A as s,E as v,c as f,d as r,n as d,z as u}from"./MDSKC43G.js";import{d as g}from"./TJWJSZZ6.js";import{b}from"./IYCX42AE.js";import"./YG7SBKS5.js";export default $arcgis.t(([,,,,,,,{Jc:y,m:l,tb:m},{a:$,b:w,c:E}])=>{var n={label:"label",fieldList:"field-list",fab:"fab"},k=f`:host{display:flex;flex-direction:column;width:var(--arcgis-charts-config-calcite-block-default-width);margin:var(--arcgis-charts-config-calcite-block-default-margin);margin-top:var(--arcgis-charts-top-section-margin)}.label,.disabled-label{display:flex;margin-left:var(--arcgis-charts-config-margin-minor);margin-right:var(--arcgis-charts-config-margin-minor);margin-bottom:var(--arcgis-charts-config-margin-minor);justify-content:space-between}.text{display:flex;margin-left:var(--arcgis-charts-config-margin-minor);width:calc(100% - 1.5rem);height:2rem;margin-bottom:var(--arcgis-charts-config-margin-minor);justify-content:space-between}.field-list{max-height:50vh;overflow-y:auto}.disabled-label{pointer-events:none}.fab{display:flex;margin-left:var(--arcgis-charts-config-margin-minor);margin-right:var(--arcgis-charts-config-margin-minor);margin-bottom:1.5rem;justify-content:center}`,p=class extends u{constructor(){super(...arguments),this._messages=P(),this.pieChartPopover=null,this.sortOrderElement=c(),this.categoryElement=c(),this.numericFieldsElement=c(),this.onPieChartDataChange=async e=>{try{if(e.detail!==null&&e.detail?.value!==void 0){let{contentKind:t}=e.detail,i=[...e.detail.value];switch(t){case a.aggregation:await this.model.setAggregationType(i[0]!==b.NoAggregation?i[0]:"");break;case a.category:{let o=i[0]?.trim()||"";this.updateMode(o);let C=this.model.getNumericFields();C.length>1&&o!==l&&await this.model.setNumericFields([C[0]]),await this.model.setCategory(o),this.model.setColorMatch(!0);break}case a.numericFields:i.length>1&&(this.updateMode(l),await this.model.setCategory(l)),await this.model.setNumericFields(i);break;case a.sortOrder:this.model.setSortOrder(i[0]);break;default:break}}}catch(t){throw this.arcgisChartsConfigDataChangeError.emit({error:t,model:this.model}),t}this.requestUpdate()},this.onModelConfigChange=()=>{this.requestUpdate()},this.popoverClose=e=>{this.pieChartPopover===e?.target&&this.removePieChartDataPopover()},this.layerFieldsInfo=[],this.arcgisChartsConfigDataChangeError=d(),this.arcgisChartsConfigPieChartDataNumericFieldValidate=d()}static{this.properties={messageOverrides:0,model:0,layerFieldsInfo:0,open:7}}static{this.styles=k}load(){this.modelChange(this.model),this.onModelConfigChange()}willUpdate(e){e.has("model")&&this.modelChange(this.model,e.get("model"))}disconnectedCallback(){super.disconnectedCallback(),this.removePieChartDataPopover(),this.model.removeEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)}modelChange(e,t){t?.removeEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange),e?.addEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)}buildNumericFieldItem(e){return F(e,r`<calcite-list-item .label=${m(this.layerFieldsInfo,e)} .value=${e} closable @calciteListItemClose=${this.onRemoveNumericField}></calcite-list-item>`)}onSortOrderSelect(){this.contentKind=a.sortOrder,this.setupPopover()}onCategorySelect(){this.contentKind=a.category,this.setupPopover()}onAddNumericFields(){this.contentKind=a.numericFields,this.setupPopover()}async onRemoveNumericField(e){let t=e.target.value;await this.model.setNumericFields(this.model.getNumericFields().filter(i=>i!==t))}onShowDataLabelsChange(e){this.model.setDataLabelsVisibility(e.target.checked)}updateMode(e){let t=e!==l&&e.trim()!=="";this.model.setMode(t?g.Category:g.Fields)}setupPopover(){this.removePieChartDataPopover();let e={layerFieldsInfo:[...this.layerFieldsInfo],onPieChartDataChange:this.onPieChartDataChange,popoverClose:this.popoverClose};if(this.pieChartPopover=E($.PieChartDataPopover,e),this.pieChartPopover!==null){switch(this.contentKind){case a.category:this.pieChartPopover.referenceElement=this.categoryElement.value,this.pieChartPopover.headingTitle=this._messages.categoryHeader,this.pieChartPopover.selectedContent=this.model.getCategory();break;case a.numericFields:this.pieChartPopover.referenceElement=this.numericFieldsElement.value,this.pieChartPopover.headingTitle=this._messages.numericFieldsMultipleHeader,this.pieChartPopover.selectedContent=this.model.getNumericFields();break;case a.sortOrder:this.pieChartPopover.referenceElement=this.sortOrderElement.value,this.pieChartPopover.headingTitle=this._messages.sortOrderHeader,this.pieChartPopover.selectedContent=this.model.getSortOrder();break}this.pieChartPopover.contentKind=this.contentKind,this.pieChartPopover.open=!0,this.addPopover()}}addPopover(){!document.body.contains(this.pieChartPopover)&&this.pieChartPopover!==null&&document.body.appendChild(this.pieChartPopover)}getCorrectedCategoryValue(){return this.model.getCategory()===l||this.model.getCategory().trim()===""?"":m(this.layerFieldsInfo,this.model.getCategory())}removePieChartDataPopover(){this.pieChartPopover!==null&&(this.pieChartPopover.open=!1,this.pieChartPopover=w(this.pieChartPopover))}renderSorting(){return r`<arcgis-charts-config-field-select .label=${this._messages[this.model.getSortOrder()]} @click=${this.onSortOrderSelect} ${h(this.sortOrderElement)}></arcgis-charts-config-field-select>`}renderCategory(){let e=this.getCorrectedCategoryValue();return r`<arcgis-charts-config-field-select .label=${e} @click=${this.onCategorySelect} ${h(this.categoryElement)}></arcgis-charts-config-field-select>`}renderNumericFields(e){let t=y(this.layerFieldsInfo),i=[];for(let o of e)o!==t&&i.push(this.buildNumericFieldItem(o));return r`<calcite-list label class=${s(n.fieldList)} ${h(this.numericFieldsElement)}>${i}</calcite-list>`}render(){let e=this.renderCategory(),t=this.renderSorting(),i=this.renderNumericFields([...this.model.getNumericFields()]);return r`<div><calcite-label class=${s(n.label)}>${this._messages.category}${e}</calcite-label>${[r`<calcite-label class=${s(n.label)}>${this._messages.numericFields}${i}</calcite-label>`,r`<div class=${s(n.fab)}><calcite-fab appearance=outline-fill kind=neutral scale=m .label=${this._messages.selectNumericFields} text-enabled .text=${this._messages.selectNumericFields} icon=plus @click=${this.onAddNumericFields}></calcite-fab></div>`]}<calcite-label class=${s(n.label)} layout=inline-space-between>${this._messages.showDataLabels}<calcite-switch .checked=${this.model.getDataLabelsVisibility()} @calciteSwitchChange=${this.onShowDataLabelsChange}></calcite-switch></calcite-label><calcite-label class=${s(n.label)}>${this._messages.sortOrder}${t}</calcite-label></div>`}};v("arcgis-charts-config-pie-chart-data",p);return p},"geometry/support/jsonUtils","rest/support/AttributeBinsQuery","rest/support/Query","rest/support/StatisticDefinition","time/TimeExtent","core/promiseUtils","request",e,i)