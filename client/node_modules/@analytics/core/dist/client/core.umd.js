!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("analytics-utils"),require("@analytics/global-storage-utils"),require("@analytics/type-utils")):"function"==typeof define&&define.amd?define(["exports","analytics-utils","@analytics/global-storage-utils","@analytics/type-utils"],n):n((e||self)._analytics={},e.analyticsUtils,e.globalStorageUtils,e.typeUtils)}(this,function(e,n,t,r){function i(){return i=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)({}).hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},i.apply(null,arguments)}var a="function",o="undefined",u="reducer",c="@@redux/",s=c+"INIT",l=c+Math.random().toString(36),f=/* #__PURE__ */function(){return typeof Symbol===a&&Symbol.observable||"@@observable"}(),d=" != "+a;function p(e,n,t){var i;if(typeof n===a&&typeof t===o&&(t=n,n=void 0),typeof t!==o){if(typeof t!==a)throw new Error("enhancer"+d);return t(p)(e,n)}if(typeof e!==a)throw new Error(u+d);var c=e,l=n,m=[],g=m,h=!1;function v(){g===m&&(g=m.slice())}function y(){return l}function b(e){if(typeof e!==a)throw new Error("Listener"+d);var n=!0;return v(),g.push(e),function(){if(n){n=!1,v();var t=g.indexOf(e);g.splice(t,1)}}}function w(e){if(!r.isObject(e))throw new Error("Act != obj");if(typeof e.type===o)throw new Error("ActType "+o);if(h)throw new Error("Dispatch in "+u);try{h=!0,l=c(l,e)}finally{h=!1}for(var n=m=g,t=0;t<n.length;t++)(0,n[t])();return e}return w({type:s}),(i={dispatch:w,subscribe:b,getState:y,replaceReducer:function(e){if(typeof e!==a)throw new Error("next "+u+d);c=e,w({type:s})}})[f]=function(){var e,n=b;return(e={subscribe:function(e){if("object"!=typeof e)throw new TypeError("Observer != obj");function t(){e.next&&e.next(y())}return t(),{unsubscribe:n(t)}}})[f]=function(){return this},e},i}function m(e,n){var t=n&&n.type;return"action "+(t&&t.toString()||"?")+u+" "+e+" returns "+o}function g(){var e=[].slice.call(arguments);return 0===e.length?function(e){return e}:1===e.length?e[0]:e.reduce(function(e,n){return function(){return e(n.apply(void 0,[].slice.call(arguments)))}})}function h(){var e=arguments;return function(n){return function(t,r,a){var o,u=n(t,r,a),c=u.dispatch,s={getState:u.getState,dispatch:function(e){return c(e)}};return o=[].slice.call(e).map(function(e){return e(s)}),i({},u,{dispatch:c=g.apply(void 0,o)(u.dispatch)})}}}var v=r.PREFIX+"anon_id",y=r.PREFIX+"user_id",b=r.PREFIX+"user_traits",w={__proto__:null,ANON_ID:v,USER_ID:y,USER_TRAITS:b},I="analytics",E="userId",P="anonymousId",S=["bootstrap","params","campaign","initializeStart","initialize","initializeEnd","ready","resetStart","reset","resetEnd","pageStart","page","pageEnd","pageAborted","trackStart","track","trackEnd","trackAborted","identifyStart","identify","identifyEnd","identifyAborted","userIdChanged","registerPlugins","enablePlugin","disablePlugin","online","offline","setItemStart","setItem","setItemEnd","setItemAborted","removeItemStart","removeItem","removeItemEnd","removeItemAborted"],O=["name","EVENTS","config","loaded"],j=S.reduce(function(e,n){return e[n]=n,e},{registerPluginType:function(e){return"registerPlugin:"+e},pluginReadyType:function(e){return"ready:"+e}}),N=/^utm_/,A=/^an_prop_/,_=/^an_trait_/;function x(e){var n=e.storage.setItem;return function(t){return function(r){return function(a){if(a.type===j.bootstrap){var o=a.params,u=a.user,c=a.persistedUser,s=a.initialUser,l=c.userId===u.userId;c.anonymousId!==u.anonymousId&&n(v,u.anonymousId),l||n(y,u.userId),s.traits&&n(b,i({},l&&c.traits?c.traits:{},s.traits));var f=Object.keys(a.params);if(f.length){var d=o.an_uid,p=o.an_event,m=f.reduce(function(e,n){if(n.match(N)||n.match(/^(d|g)clid/)){var t=n.replace(N,"");e.campaign["campaign"===t?"name":t]=o[n]}return n.match(A)&&(e.props[n.replace(A,"")]=o[n]),n.match(_)&&(e.traits[n.replace(_,"")]=o[n]),e},{campaign:{},props:{},traits:{}});t.dispatch(i({type:j.params,raw:o},m,d?{userId:d}:{})),d&&setTimeout(function(){return e.identify(d,m.traits)},0),p&&setTimeout(function(){return e.track(p,m.props)},0),Object.keys(m.campaign).length&&t.dispatch({type:j.campaign,campaign:m.campaign})}}return r(a)}}}}function k(e){return function(n,t){if(void 0===n&&(n={}),void 0===t&&(t={}),t.type===j.setItemEnd){if(t.key===v)return i({},n,{anonymousId:t.value});if(t.key===y)return i({},n,{userId:t.value})}switch(t.type){case j.identify:return Object.assign({},n,{userId:t.userId,traits:i({},n.traits,t.traits)});case j.reset:return[y,v,b].forEach(function(n){e.removeItem(n)}),Object.assign({},n,{userId:null,anonymousId:null,traits:{}});default:return n}}}function T(e){return{userId:e.getItem(y),anonymousId:e.getItem(v),traits:e.getItem(b)}}var z=function(e){return r.PREFIX+"TEMP"+r.PREFIX+e};function M(e){var r=e.storage,a=r.setItem,o=r.removeItem,u=r.getItem;return function(e){return function(r){return function(c){var s=c.userId,l=c.traits,f=c.options;if(c.type===j.reset&&([y,b,v].forEach(function(e){o(e)}),[E,P,"traits"].forEach(function(e){t.remove(z(e))})),c.type===j.identify){u(v)||a(v,n.uuid());var d=u(y),p=u(b)||{};d&&d!==s&&e.dispatch({type:j.userIdChanged,old:{userId:d,traits:p},new:{userId:s,traits:l},options:f}),s&&a(y,s),l&&a(b,i({},p,l))}return r(c)}}}}var q={};function B(e,n){q[e]&&r.isFunction(q[e])&&(q[e](n),delete q[e])}function F(e,n,t){return new Promise(function(r,a){return n()?r(e):t<1?a(i({},e,{queue:!0})):new Promise(function(e){return setTimeout(e,10)}).then(function(i){return F(e,n,t-10).then(r,a)})})}function U(e){return{abort:e}}function R(e,n,t){var a={},o=n(),u=e.getState(),c=u.plugins,s=u.queue,l=u.user;if(!u.context.offline&&s&&s.actions&&s.actions.length){var f=s.actions.reduce(function(e,n,t){return c[n.plugin].loaded?(e.process.push(n),e.processIndex.push(t)):(e.requeue.push(n),e.requeueIndex.push(t)),e},{processIndex:[],process:[],requeue:[],requeueIndex:[]});if(f.processIndex&&f.processIndex.length){f.processIndex.forEach(function(n){var u=s.actions[n],f=u.plugin,d=u.payload.type,p=o[f][d];if(p&&r.isFunction(p)){var m,g=function(e,n){return void 0===e&&(e={}),void 0===n&&(n={}),[E,P].reduce(function(t,r){return e.hasOwnProperty(r)&&n[r]&&n[r]!==e[r]&&(t[r]=n[r]),t},e)}(u.payload,l),h=a[g.meta.rid];if(!h&&(m=p({payload:g,config:c[f].config,instance:t,abort:U}))&&r.isObject(m)&&m.abort)return void(a[g.meta.rid]=!0);if(!h){var v=d+":"+f;e.dispatch(i({},g,{type:v,_:{called:v,from:"queueDrain"}}))}}});var d=s.actions.filter(function(e,n){return!~f.processIndex.indexOf(n)});s.actions=d}}}var L=function(e){var n=e.data,t=e.action,a=e.instance,o=e.state,u=e.allPlugins,c=e.allMatches,s=e.store,l=e.EVENTS;try{var f=o.plugins,d=o.context,p=t.type,m=p.match(V),g=n.exact.map(function(e){return e.pluginName});m&&(g=c.during.map(function(e){return e.pluginName}));var h=function(e,n){return function(t,r,a){var o=r.config,u=r.name,c=u+"."+t.type;a&&(c=a.event);var s=t.type.match(V)?function(e,n,t,r,a){return function(o,u){var c=r?r.name:e,s=u&&Y(u)?u:t;if(r&&(!(s=u&&Y(u)?u:[e]).includes(e)||1!==s.length))throw new Error("Method "+n+" can only abort "+e+" plugin. "+JSON.stringify(s)+" input valid");return i({},a,{abort:{reason:o,plugins:s,caller:n,_:c}})}}(u,c,n,a,t):function(e,n){return function(){throw new Error(e.type+" action not cancellable. Remove abort in "+n)}}(t,c);return{payload:Q(t),instance:e,config:o||{},abort:s}}}(a,g),v=n.exact.reduce(function(e,n){var t=n.pluginName,r=n.methodName,i=!1;return r.match(/^initialize/)||r.match(/^reset/)||(i=!f[t].loaded),d.offline&&r.match(/^(page|track|identify)/)&&(i=!0),e[""+t]=i,e},{});return Promise.resolve(n.exact.reduce(function(e,o,c){var s=o.pluginName;return Promise.resolve(e).then(function(e){function o(){return Promise.resolve(e)}var c=function(){if(n.namespaced&&n.namespaced[s])return Promise.resolve(n.namespaced[s].reduce(function(e,n,t){return Promise.resolve(e).then(function(e){return n.method&&r.isFunction(n.method)?(function(e,n){var t=G(e);if(t&&t.name===n){var r=G(t.method);throw new Error([n+" plugin is calling method "+e,"Plugins cant call self","Use "+t.method+" "+(r?"or "+r.method:"")+" in "+n+" plugin insteadof "+e].join("\n"))}}(n.methodName,n.pluginName),Promise.resolve(n.method({payload:e,instance:a,abort:(t=e,o=s,c=n.pluginName,function(e,n){return i({},t,{abort:{reason:e,plugins:n||[o],caller:p,from:c||o}})}),config:D(n.pluginName,f,u),plugins:f})).then(function(n){var t=r.isObject(n)?n:{};return Promise.resolve(i({},e,t))})):e;var t,o,c})},Promise.resolve(t))).then(function(n){e[s]=n});e[s]=t}();return c&&c.then?c.then(o):o()})},Promise.resolve({}))).then(function(e){return Promise.resolve(n.exact.reduce(function(t,o,c){try{var l=n.exact.length===c+1,d=o.pluginName,g=u[d];return Promise.resolve(t).then(function(n){var t=e[d]?e[d]:{};if(m&&(t=n),H(t,d))return $({data:t,method:p,instance:a,pluginName:d,store:s}),Promise.resolve(n);if(H(n,d))return l&&$({data:n,method:p,instance:a,store:s}),Promise.resolve(n);if(v.hasOwnProperty(d)&&!0===v[d])return s.dispatch({type:"queue",plugin:d,payload:t,_:{called:"queue",from:"queueMechanism"}}),Promise.resolve(n);var o=h(e[d],u[d]);return Promise.resolve(g[p]({abort:o.abort,payload:t,instance:a,config:D(d,f,u),plugins:f})).then(function(o){var u=r.isObject(o)?o:{},c=i({},n,u),l=e[d];if(H(l,d))$({data:l,method:p,instance:a,pluginName:d,store:s});else{var f=p+":"+d;(f.match(/:/g)||[]).length<2&&!p.match(C)&&!p.match(X)&&a.dispatch(i({},m?c:t,{type:f,_:{called:f,from:"submethod"}}))}return Promise.resolve(c)})})}catch(e){return Promise.reject(e)}},Promise.resolve(t))).then(function(e){if(!(p.match(V)||p.match(/^registerPlugin/)||p.match(X)||p.match(C)||p.match(/^params/)||p.match(/^userIdChanged/))){if(l.plugins.includes(p),e._&&e._.originalAction===p)return e;var t=i({},e,{_:{originalAction:e.type,called:e.type,from:"engineEnd"}});K(e,n.exact.length)&&!p.match(/End$/)&&(t=i({},t,{type:e.type+"Aborted"})),s.dispatch(t)}return e})})}catch(e){return Promise.reject(e)}},V=/Start$/,C=/^bootstrap/,X=/^ready/;function $(e){var n=e.pluginName,t=e.method+"Aborted"+(n?":"+n:"");e.store.dispatch(i({},e.data,{type:t,_:{called:t,from:"abort"}}))}function D(e,n,t){var r=n[e]||t[e];return r&&r.config?r.config:{}}function J(e,n){return n.reduce(function(n,t){return t[e]?n.concat({methodName:e,pluginName:t.name,method:t[e]}):n},[])}function W(e,n){var t=e.replace(V,""),r=n?":"+n:"";return[""+e+r,""+t+r,t+"End"+r]}function H(e,n){var t=e.abort;return!!t&&(!0===t||Z(t,n)||t&&Z(t.plugins,n))}function K(e,n){var t=e.abort;if(!t)return!1;if(!0===t||r.isString(t))return!0;var i=t.plugins;return Y(t)&&t.length===n||Y(i)&&i.length===n}function Y(e){return Array.isArray(e)}function Z(e,n){return!(!e||!Y(e))&&e.includes(n)}function G(e){var n=e.match(/(.*):(.*)/);return!!n&&{method:n[1],name:n[2]}}function Q(e){return Object.keys(e).reduce(function(n,t){return"type"===t||(n[t]=r.isObject(e[t])?Object.assign({},e[t]):e[t]),n},{})}function ee(e,n,t){var a={};return function(o){return function(u){return function(c){try{var s,l=function(e){return s?e:u(p)},f=c.type,d=c.plugins,p=c;if(c.abort)return Promise.resolve(u(c));if(f===j.enablePlugin&&o.dispatch({type:j.initializeStart,plugins:d,disabled:[],fromEnable:!0,meta:c.meta}),f===j.disablePlugin&&setTimeout(function(){return B(c.meta.rid,{payload:c})},0),f===j.initializeEnd){var m=n(),g=Object.keys(m),h=g.filter(function(e){return d.includes(e)}).map(function(e){return m[e]}),v=[],y=[],b=c.disabled,w=h.map(function(e){var n=e.loaded,t=e.name,r=e.config;return F(e,function(){return n({config:r})},1e4).then(function(n){return a[t]||(o.dispatch({type:j.pluginReadyType(t),name:t,events:Object.keys(e).filter(function(e){return!O.includes(e)})}),a[t]=!0),v=v.concat(t),e}).catch(function(e){if(e instanceof Error)throw new Error(e);return y=y.concat(e.name),e})});Promise.all(w).then(function(e){var n={plugins:v,failed:y,disabled:b};setTimeout(function(){g.length===w.length+b.length&&o.dispatch(i({},{type:j.ready},n))},0)})}var I=function(){if(f!==j.bootstrap)return/^ready:([^:]*)$/.test(f)&&setTimeout(function(){return R(o,n,e)},0),Promise.resolve(function(e,n,t,a,o){try{var u=r.isFunction(n)?n():n,c=e.type,s=c.replace(V,"");if(e._&&e._.called)return Promise.resolve(e);var l=t.getState(),f=(m=u,void 0===(g=l.plugins)&&(g={}),void 0===(h=e.options)&&(h={}),Object.keys(m).filter(function(e){var n=h.plugins||{};return r.isBoolean(n[e])?n[e]:!1!==n.all&&(!g[e]||!1!==g[e].enabled)}).map(function(e){return m[e]}));c===j.initializeStart&&e.fromEnable&&(f=Object.keys(l.plugins).filter(function(n){var t=l.plugins[n];return e.plugins.includes(n)&&!t.initialized}).map(function(e){return u[e]}));var d=f.map(function(e){return e.name}),p=function(e,n){var t=W(e).map(function(e){return J(e,n)});return n.reduce(function(t,r){var i=r.name,a=W(e,i).map(function(e){return J(e,n)}),o=a[0],u=a[1],c=a[2];return o.length&&(t.beforeNS[i]=o),u.length&&(t.duringNS[i]=u),c.length&&(t.afterNS[i]=c),t},{before:t[0],beforeNS:{},during:t[1],duringNS:{},after:t[2],afterNS:{}})}(c,f);return Promise.resolve(L({action:e,data:{exact:p.before,namespaced:p.beforeNS},state:l,allPlugins:u,allMatches:p,instance:t,store:a,EVENTS:o})).then(function(e){function n(){var n=function(){if(c.match(V))return Promise.resolve(L({action:i({},r,{type:s+"End"}),data:{exact:p.after,namespaced:p.afterNS},state:l,allPlugins:u,allMatches:p,instance:t,store:a,EVENTS:o})).then(function(e){e.meta&&e.meta.hasCallback&&B(e.meta.rid,{payload:e})})}();return n&&n.then?n.then(function(){return e}):e}if(K(e,d.length))return e;var r,f=function(){if(c!==s)return Promise.resolve(L({action:i({},e,{type:s}),data:{exact:p.during,namespaced:p.duringNS},state:l,allPlugins:u,allMatches:p,instance:t,store:a,EVENTS:o})).then(function(e){r=e});r=e}();return f&&f.then?f.then(n):n()})}catch(e){return Promise.reject(e)}var m,g,h}(c,n,e,o,t)).then(function(e){var n=u(e);return s=1,n})}();return Promise.resolve(I&&I.then?I.then(l):l(I))}catch(e){return Promise.reject(e)}}}}}function ne(e){return function(n){return function(n){return function(t){var r=t.type,i=t.key,a=t.value,o=t.options;if(r===j.setItem||r===j.removeItem){if(t.abort)return n(t);r===j.setItem?e.setItem(i,a,o):e.removeItem(i,o)}return n(t)}}}}var te=function(){var e=this;this.before=[],this.after=[],this.addMiddleware=function(n,t){e[t]=e[t].concat(n)},this.removeMiddleware=function(n,t){var r=e[t].findIndex(function(e){return e===n});-1!==r&&(e[t]=[].concat(e[t].slice(0,r),e[t].slice(r+1)))},this.dynamicMiddlewares=function(n){return function(t){return function(r){return function(i){var a={getState:t.getState,dispatch:function(e){return t.dispatch(e)}},o=e[n].map(function(e){return e(a)});return g.apply(void 0,o)(r)(i)}}}}};function re(e){return function(n,t){void 0===n&&(n={});var r={};if("initialize:aborted"===t.type)return n;if(/^registerPlugin:([^:]*)$/.test(t.type)){var a=ie(t.type,"registerPlugin"),o=e()[a];if(!o||!a)return n;var u=t.enabled,c=o.config;return r[a]={enabled:u,initialized:!!u&&Boolean(!o.initialize),loaded:!!u&&Boolean(o.loaded({config:c})),config:c},i({},n,r)}if(/^initialize:([^:]*)$/.test(t.type)){var s=ie(t.type,j.initialize),l=e()[s];return l&&s?(r[s]=i({},n[s],{initialized:!0,loaded:Boolean(l.loaded({config:l.config}))}),i({},n,r)):n}if(/^ready:([^:]*)$/.test(t.type))return r[t.name]=i({},n[t.name],{loaded:!0}),i({},n,r);switch(t.type){case j.disablePlugin:return i({},n,ae(t.plugins,!1,n));case j.enablePlugin:return i({},n,ae(t.plugins,!0,n));default:return n}}}function ie(e,n){return e.substring(n.length+1,e.length)}function ae(e,n,t){return e.reduce(function(e,r){return e[r]=i({},t[r],{enabled:n}),e},t)}function oe(e){try{return JSON.parse(JSON.stringify(e))}catch(e){}return e}var ue={last:{},history:[]};function ce(e,n){void 0===e&&(e=ue);var t=n.options,r=n.meta;if(n.type===j.track){var a=oe(i({event:n.event,properties:n.properties},Object.keys(t).length&&{options:t},{meta:r}));return i({},e,{last:a,history:e.history.concat(a)})}return e}var se={actions:[]};function le(e,n){void 0===e&&(e=se);var t=n.payload;switch(n.type){case"queue":var r;return r=t&&t.type&&t.type===j.identify?[n].concat(e.actions):e.actions.concat(n),i({},e,{actions:r});case"dequeue":return[];default:return e}}var fe=/#.*$/;function de(e){var n=/(http[s]?:\/\/)?([^\/\s]+\/)(.*)/g.exec(e);return"/"+(n&&n[3]?n[3].split("?")[0].replace(fe,""):"")}var pe,me,ge,he,ve=function(e){if(void 0===e&&(e={}),!r.isBrowser)return e;var n=document,t=n.title,a=n.referrer,o=window,u=o.location,c=o.innerWidth,s=o.innerHeight,l=u.hash,f=u.search,d=function(e){var n=function(){if(r.isBrowser)for(var e,n=document.getElementsByTagName("link"),t=0;e=n[t];t++)if("canonical"===e.getAttribute("rel"))return e.getAttribute("href")}();return n?n.match(/\?/)?n:n+e:window.location.href.replace(fe,"")}(f),p={title:t,url:d,path:de(d),hash:l,search:f,width:c,height:s};return a&&""!==a&&(p.referrer=a),i({},p,e)},ye={last:{},history:[]};function be(e,n){void 0===e&&(e=ye);var t=n.options;if(n.type===j.page){var r=oe(i({properties:n.properties,meta:n.meta},Object.keys(t).length&&{options:t}));return i({},e,{last:r,history:e.history.concat(r)})}return e}pe=function(){if(!r.isBrowser)return!1;var e=navigator.appVersion;return~e.indexOf("Win")?"Windows":~e.indexOf("Mac")?"MacOS":~e.indexOf("X11")?"UNIX":~e.indexOf("Linux")?"Linux":"Unknown OS"}(),me=r.isBrowser?document.referrer:null,ge=n.getBrowserLocale(),he=n.getTimeZone();var we={initialized:!1,sessionId:n.uuid(),app:null,version:null,debug:!1,offline:!!r.isBrowser&&!navigator.onLine,os:{name:pe},userAgent:r.isBrowser?navigator.userAgent:"node",library:{name:I,version:"0.13.1"},timezone:he,locale:ge,campaign:{},referrer:me};function Ie(e,n){void 0===e&&(e=we);var t=e.initialized,r=n.campaign;switch(n.type){case j.campaign:return i({},e,{campaign:r});case j.offline:return i({},e,{offline:!0});case j.online:return i({},e,{offline:!1});default:return t?e:i({},we,e,{initialized:!0})}}var Ee=["plugins","reducers","storage"];function Pe(e,n,t){if(r.isBrowser){var i=window[(t?"add":"remove")+"EventListener"];e.split(" ").forEach(function(e){i(e,n)})}}function Se(e){var n=Pe.bind(null,"online offline",function(n){return Promise.resolve(!navigator.onLine).then(e)});return n(!0),function(e){return n(!1)}}function Oe(){return t.set(I,[]),function(e){return function(n,r,i){var a=e(n,r,i),o=a.dispatch;return Object.assign(a,{dispatch:function(e){return t.globalContext[t.KEY][I].push(e.action||e),o(e)}})}}}function je(e){return function(){return g(g.apply(null,arguments),Oe())}}function Ne(e){return e?r.isArray(e)?e:[e]:[]}function Ae(e,t,a){void 0===e&&(e={});var o,u,c=n.uuid();return t&&(q[c]=(o=t,u=function(e){for(var n,t=e||Array.prototype.slice.call(arguments),i=0;i<t.length;i++)if(r.isFunction(t[i])){n=t[i];break}return n}(a),function(e){u&&u(e),o(e)})),i({},e,{rid:c,ts:(new Date).getTime()},t?{hasCallback:!0}:{})}function _e(e){void 0===e&&(e={});var c=e.reducers||{},f=e.initialUser||{},d=(e.plugins||[]).reduce(function(e,n){if(r.isFunction(n))return e.middlewares=e.middlewares.concat(n),e;if(n.NAMESPACE&&(n.name=n.NAMESPACE),!n.name)throw new Error("https://lytics.dev/errors/1");n.config||(n.config={});var t=n.EVENTS?Object.keys(n.EVENTS).map(function(e){return n.EVENTS[e]}):[];e.pluginEnabled[n.name]=!(!1===n.enabled||!1===n.config.enabled),delete n.enabled,n.methods&&(e.methods[n.name]=Object.keys(n.methods).reduce(function(e,t){var r;return e[t]=(r=n.methods[t],function(){for(var e=Array.prototype.slice.call(arguments),n=new Array(r.length),t=0;t<e.length;t++)n[t]=e[t];return n[n.length]=J,r.apply({instance:J},n)}),e},{}),delete n.methods);var i=Object.keys(n).concat(t),a=new Set(e.events.concat(i));if(e.events=Array.from(a),e.pluginsArray=e.pluginsArray.concat(n),e.plugins[n.name])throw new Error(n.name+"AlreadyLoaded");return e.plugins[n.name]=n,e.plugins[n.name].loaded||(e.plugins[n.name].loaded=function(){return!0}),e},{plugins:{},pluginEnabled:{},methods:{},pluginsArray:[],middlewares:[],events:[]}),y=e.storage?e.storage:{getItem:t.get,setItem:t.set,removeItem:t.remove},b=function(e){return function(n,i,a){return i.getState("user")[n]||(a&&r.isObject(a)&&a[n]?a[n]:T(e)[n]||t.get(z(n))||null)}}(y),w=d.plugins,I=d.events.filter(function(e){return!O.includes(e)}).sort(),N=new Set(I.concat(S).filter(function(e){return!O.includes(e)})),A=Array.from(N).sort(),_=function(){return w},q=new te,B=q.addMiddleware,F=q.removeMiddleware,U=q.dynamicMiddlewares,L=function(){throw new Error("Abort disabled inListener")},V=n.paramsParse(),C=T(y),X=i({},C,f,V.an_uid?{userId:V.an_uid}:{},V.an_aid?{anonymousId:V.an_aid}:{});X.anonymousId||(X.anonymousId=n.uuid());var $=i({enable:function(e,n){return new Promise(function(t){oe.dispatch({type:j.enablePlugin,plugins:Ne(e),_:{originalAction:j.enablePlugin}},t,[n])})},disable:function(e,n){return new Promise(function(t){oe.dispatch({type:j.disablePlugin,plugins:Ne(e),_:{originalAction:j.disablePlugin}},t,[n])})}},d.methods),D=!1,J={identify:function(e,n,a,o){try{var u=r.isString(e)?e:null,c=r.isObject(e)?e:n,s=a||{},l=J.user();t.set(z(E),u);var f=u||c.userId||b(E,J,c);return Promise.resolve(new Promise(function(e){oe.dispatch(i({type:j.identifyStart,userId:f,traits:c||{},options:s,anonymousId:l.anonymousId},l.id&&l.id!==u&&{previousId:l.id}),e,[n,a,o])}))}catch(e){return Promise.reject(e)}},track:function(e,n,t,i){try{var a=r.isObject(e)?e.event:e;if(!a||!r.isString(a))throw new Error("EventMissing");var o=r.isObject(e)?e:n||{},u=r.isObject(t)?t:{};return Promise.resolve(new Promise(function(e){oe.dispatch({type:j.trackStart,event:a,properties:o,options:u,userId:b(E,J,n),anonymousId:b(P,J,n)},e,[n,t,i])}))}catch(e){return Promise.reject(e)}},page:function(e,n,t){try{var i=r.isObject(e)?e:{},a=r.isObject(n)?n:{};return Promise.resolve(new Promise(function(r){oe.dispatch({type:j.pageStart,properties:ve(i),options:a,userId:b(E,J,i),anonymousId:b(P,J,i)},r,[e,n,t])}))}catch(e){return Promise.reject(e)}},user:function(e){if(e===E||"id"===e)return b(E,J);if(e===P||"anonId"===e)return b(P,J);var t=J.getState("user");return e?n.dotProp(t,e):t},reset:function(e){return new Promise(function(n){oe.dispatch({type:j.resetStart},n,e)})},ready:function(e){return D&&e({plugins:$,instance:J}),J.on(j.ready,function(n){e&&e(n),D=!0})},on:function(e,n){if(!e||!r.isFunction(n))return!1;if(e===j.bootstrap)throw new Error(".on disabled for "+e);var t=/Start$|Start:/;if("*"===e){var i=function(e){return function(e){return function(r){return r.type.match(t)&&n({payload:r,instance:J,plugins:w}),e(r)}}},a=function(e){return function(e){return function(r){return r.type.match(t)||n({payload:r,instance:J,plugins:w}),e(r)}}};return B(i,xe),B(a,ke),function(){F(i,xe),F(a,ke)}}var o=e.match(t)?xe:ke,u=function(t){return function(t){return function(r){return r.type===e&&n({payload:r,instance:J,plugins:w,abort:L}),t(r)}}};return B(u,o),function(){return F(u,o)}},once:function(e,n){if(!e||!r.isFunction(n))return!1;if(e===j.bootstrap)throw new Error(".once disabled for "+e);var t=J.on(e,function(e){n({payload:e.payload,instance:J,plugins:w,abort:L}),t()});return t},getState:function(e){var t=oe.getState();return e?n.dotProp(t,e):Object.assign({},t)},dispatch:function(e){var n=r.isString(e)?{type:e}:e;if(S.includes(n.type))throw new Error("reserved action "+n.type);var t=i({},n,{_:i({originalAction:n.type},e._||{})});oe.dispatch(t)},enablePlugin:$.enable,disablePlugin:$.disable,plugins:$,storage:{getItem:y.getItem,setItem:function(e,n,t){oe.dispatch({type:j.setItemStart,key:e,value:n,options:t})},removeItem:function(e,n){oe.dispatch({type:j.removeItemStart,key:e,options:n})}},setAnonymousId:function(e,n){J.storage.setItem(v,e,n)},events:{core:S,plugins:I}},W=d.middlewares.concat([function(e){return function(e){return function(n){return n.meta||(n.meta=Ae()),e(n)}}},U(xe),ee(J,_,{all:A,plugins:I}),ne(y),x(J),M(J),U(ke)]),H={context:Ie,user:k(y),page:be,track:ce,plugins:re(_),queue:le},K=g,Y=g;if(r.isBrowser&&e.debug){var Z=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__;Z&&(K=Z({trace:!0,traceLimit:25})),Y=function(){return 0===arguments.length?Oe():r.isObject(typeof arguments[0])?je():je().apply(null,arguments)}}var G,Q=function(e){return Object.keys(e).reduce(function(n,t){return Ee.includes(t)||(n[t]=e[t]),n},{})}(e),ie=d.pluginsArray.reduce(function(e,n){var t=n.name,r=n.config,i=n.loaded,a=d.pluginEnabled[t];return e[t]={enabled:a,initialized:!!a&&Boolean(!n.initialize),loaded:Boolean(i({config:r})),config:r},e},{}),ae={context:Q,user:X,plugins:ie},oe=p(function(e){for(var n=Object.keys(e),t={},r=0;r<n.length;r++){var i=n[r];typeof e[i]===a&&(t[i]=e[i])}var c,f=Object.keys(t);try{!function(e){Object.keys(e).forEach(function(n){var t=e[n];if(typeof t(void 0,{type:s})===o||typeof t(void 0,{type:l})===o)throw new Error(u+" "+n+" "+o)})}(t)}catch(e){c=e}return function(e,n){if(void 0===e&&(e={}),c)throw c;for(var r=!1,i={},a=0;a<f.length;a++){var u=f[a],s=e[u],l=(0,t[u])(s,n);if(typeof l===o){var d=m(u,n);throw new Error(d)}i[u]=l,r=r||l!==s}return r?i:e}}(i({},H,c)),ae,Y(K(h.apply(void 0,W))));oe.dispatch=(G=oe.dispatch,function(e,n,t){var r=i({},e,{meta:Ae(e.meta,n,Ne(t))});return G.apply(null,[r])});var ue=Object.keys(w);oe.dispatch({type:j.bootstrap,plugins:ue,config:Q,params:V,user:X,initialUser:f,persistedUser:C});var se=ue.filter(function(e){return d.pluginEnabled[e]}),fe=ue.filter(function(e){return!d.pluginEnabled[e]});return oe.dispatch({type:j.registerPlugins,plugins:ue,enabled:d.pluginEnabled}),d.pluginsArray.map(function(e,n){var t=e.bootstrap,i=e.config,a=e.name;t&&r.isFunction(t)&&t({instance:J,config:i,payload:e}),oe.dispatch({type:j.registerPluginType(a),name:a,enabled:d.pluginEnabled[a],plugin:e}),d.pluginsArray.length===n+1&&oe.dispatch({type:j.initializeStart,plugins:se,disabled:fe})}),Se(function(e){oe.dispatch({type:e?j.offline:j.online})}),function(e,n,t){setInterval(function(){return R(e,n,t)},3e3)}(oe,_,J),J}var xe="before",ke="after";e.Analytics=_e,e.CONSTANTS=w,e.EVENTS=j,e.default=_e,e.init=_e});
//# sourceMappingURL=core.umd.js.map
