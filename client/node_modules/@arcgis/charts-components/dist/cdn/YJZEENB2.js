/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
v4.33.19 */
import{a as m,b as g}from"./EHA2DPVG.js";import{a as v}from"./NEMZXIB4.js";import c from"./NCOEWMF7.js";import b from"./5NI5R3AO.js";import{a as x}from"./QDODWAYJ.js";import"./ITSRCSFZ.js";import a from"./PDDPZQ7S.js";import{A as s,B as u,E,c as L,d,n as C,z as T}from"./MDSKC43G.js";import{e as h}from"./TJWJSZZ6.js";import"./IYCX42AE.js";import"./YG7SBKS5.js";export default $arcgis.t(([,,,,,,,{fb:I,ga:$,h:G,t:N,x:f,z:_},{a:P,g:p,o:O,p:D},{a:M,b:k,c:w}])=>{var a={sectionLabel:"section-label",label:"label",sliceList:"slice-list",radioGroup:"radio-group",pieDonutLabelsContainer:"pie-donut-labels-container",sliderInputContainer:"slider-input-container",groupingLabelContainer:"grouping-label-container",numberInput:"number-input"},j=L`:host{display:flex;flex-direction:column;width:var(--arcgis-charts-config-calcite-block-default-width);margin:var(--arcgis-charts-config-calcite-block-default-margin)}.section-label{display:flex;margin:var(--arcgis-charts-config-margin-major) var(--arcgis-charts-config-margin-minor);justify-content:space-between;align-items:center;font-weight:var(--calcite-font-weight-medium);font-size:var(--calcite-font-size-0)}.label{display:flex;margin-left:var(--arcgis-charts-config-margin-minor);margin-right:var(--arcgis-charts-config-margin-minor);margin-bottom:var(--arcgis-charts-config-margin-minor);justify-content:space-between}.label .grouping-label-container{display:flex;justify-content:space-between}.label .slider-input-container{display:flex}.label .slider-input-container calcite-slider{--calcite-label-margin-bottom: var(--arcgis-charts-intra-section-margin) !important;margin-right:var(--arcgis-charts-config-margin-minor);flex-grow:1}.label .slider-input-container .number-input{width:8rem}.slice-list{margin-left:var(--arcgis-charts-config-margin-minor);margin-right:var(--arcgis-charts-config-margin-minor);margin-bottom:var(--arcgis-charts-config-margin-major)}.radio-group{margin-top:var(--arcgis-charts-config-margin-minor)}.pie-donut-labels-container{display:flex;justify-content:space-between;margin-top:calc(var(--arcgis-charts-config-margin-minor) * -3)}`,y=class extends T{constructor(){super(...arguments),this._messages=x(),this.slicesPopover=null,this.donutSizeSliderElement=m(),this.groupingThresholdElement=m(),this.groupingThresholdSliderElement=m(),this.labelCharacterLimitElement=m(),this.decimalPlacesElement=m(),this.onDonutSizeSliderChange=f(()=>{this.donutSizeSliderElement.value&&Number.isInteger(this.donutSizeSliderElement.value?.value)&&this.model.setInnerRadiusSize(this.donutSizeSliderElement.value.value??I)},P.SliderTimer),this.onGroupingThresholdSliderChange=f(()=>{let e=this.groupingThresholdSliderElement.value?.value;e!==void 0&&!Number.isNaN(e)?(this.groupingThresholdElement?.value&&(this.groupingThresholdElement.value.value=e.toString()),this.groupingThresholdSliderElement.value&&(this.groupingThresholdSliderElement.value.value=e),this.model.setGroupingThreshold(e)):this.model.setGroupingThreshold(0)},P.SliderTimer),this.sliceNameChange=e=>{if(e.detail!==null||e.detail!==void 0){let l=e.detail?.name,i=this.model.getSlices()?.findIndex(n=>n.sliceId===this.selectedSliceId),t=this.model.getSliceGrouping();i!=null&&i>=0?this.model.setSliceName(l,i):t?.sliceId===this.selectedSliceId&&t!==void 0&&this.model.setSliceGrouping({...t,label:l})}},this.sliceColorChange=e=>{if(e.detail!==null&&e.detail!==void 0){let{color:l}=e.detail,i=this.model.getSlices()?.findIndex(n=>n.sliceId===this.selectedSliceId),t=this.model.getSliceGrouping();i!=null&&i>=0?(this.model.setColorMatch(!1),this.model.setSliceColor(l,i)):t?.sliceId===this.selectedSliceId&&t!==void 0&&(this.model.setColorMatch(!1),this.model.setSliceGrouping({...t,fillSymbol:{...t.fillSymbol,type:G.SFS,color:l}}))}},this.slicesPopoverClose=()=>{this.selectedSliceId=void 0,this.configSliceOpen=!1},this.onModelConfigChange=()=>{this.requestUpdate()},this.openChange=e=>{this.arcgisChartsConfigPopoverOpenChange.emit(e.detail)},this.configSliceOpen=!1,this.popoverPlacement="leading",this.arcgisChartsConfigPieChartSlicesPopoverChange=C(),this.arcgisChartsConfigPopoverOpenChange=C()}static{this.properties={selectedSliceId:16,messageOverrides:0,model:0,configSliceOpen:5,popoverPlacement:1,chartData:0}}static{this.styles=j}load(){this.modelChange(this.model),this.onModelConfigChange()}willUpdate(e){e.has("model")&&this.modelChange(this.model,e.get("model")),e.has("selectedSliceId")&&this.selectedSliceIdChange()}disconnectedCallback(){super.disconnectedCallback(),this.removeSlicesPopover(),this.model.removeEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)}modelChange(e,l){l?.removeEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange),e?.addEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)}selectedSliceIdChange(){if(!_(this.selectedSliceId)&&this.configSliceOpen){if(this.setupSlicesPopover(),this.slicesPopover!==null){let e=this.model.getSlices(),l=this.model.getSliceGrouping();if(this.selectedSliceId===l?.sliceId)this.slicesPopover.selectedName=l?.label,this.slicesPopover.selectedColor=l?.fillSymbol?.color;else if(e!==void 0){let i=e.findIndex(t=>t.sliceId===this.selectedSliceId);this.slicesPopover.selectedName=this.model.getSliceName(i),this.slicesPopover.selectedColor=this.model.getSliceColor(i)}this.slicesPopover.open||(this.slicesPopover.open=!0)}this.addSlicesPopover()}}removeSlicesPopover(){this.slicesPopover!==void 0&&this.slicesPopover!==null&&(this.slicesPopover.open=!1,this.slicesPopover.selectedName=void 0,this.slicesPopover.selectedColor=void 0,this.slicesPopover=k(this.slicesPopover)),this.slicesPopoverChange(!1)}buildSliceListItem(){let e="#CCCCCC",l="minus-square",i=[],t=this.model.getSlices(),n=this.chartData?.dataItems;n&&(t=t?.filter(o=>n?.findIndex(c=>c.arcgis_charts_slice_id===o.sliceId)!==-1)),t?.forEach(o=>{if(o.fillSymbol?.color!==void 0){l="square-f";let[c,b,S,z]=[...o.fillSymbol.color];e=`rgba(${c},${b},${S},${z/255})`}if(o!==void 0&&!this.model.getGroupedSliceIds().includes(o.sliceId)){let c=o.sliceId;c===$.emptySliceId?c=this._messages.emptySlice??"":c===$.nullSliceId&&(c=this._messages.nullSlice??""),i?.push(v(o.sliceId,d`<calcite-list-item .label=${o.label??o.sliceId} .description=${c} .value=${o.sliceId} .selected=${this.selectedSliceId===o.sliceId} @click=${this.openSlicesPopover}><calcite-icon slot=content-end .icon=${l} style=${u({color:e})}></calcite-icon></calcite-list-item>`))}});let r=this.model.getSliceGrouping();if(r?.fillSymbol?.color!==void 0){l="square-f";let[o,c,b,S]=[...r.fillSymbol.color];e=`rgba(${o},${c},${b},${S/255})`}return this.model.getGroupedSliceIds().length>0&&i?.push(v(r?.sliceId,d`<calcite-list-item .label=${r?.label??r?.sliceId??""} .description=${this._messages.groupedSlices} .value=${r?.sliceId??""} .selected=${this.selectedSliceId===r?.sliceId} @click=${this.openSlicesPopover}><calcite-icon slot=content-end .icon=${l} style=${u({color:e})}></calcite-icon></calcite-list-item>`)),i}buildGroupedSlicesListItem(){let e="#CCCCCC",l="minus-square",i=[];return this.model.getSlices()?.forEach(t=>{if(t.fillSymbol?.color!==void 0){l="square-f";let[n,r,o,c]=[...t.fillSymbol.color];e=`rgba(${n},${r},${o},${c/255})`}t!==void 0&&this.model.getGroupedSliceIds().includes(t.sliceId)&&i?.push(v(t.sliceId,d`<calcite-list-item .label=${t.label??t.sliceId} .description=${t.sliceId} .value=${t.sliceId} .selected=${this.selectedSliceId===t.sliceId} @click=${this.openSlicesPopover}><calcite-icon slot=content-end .icon=${l} style=${u({color:e})}></calcite-icon></calcite-list-item>`))}),i}buildSliceList(){return d`<calcite-list label class=${s(a.sliceList)} selection-mode=single selection-appearance=border @calciteListOrderChange=${this.onCalciteListOrderChange}>${this.buildSliceListItem()}</calcite-list>`}buildGroupedSliceList(){return d`<calcite-list label class=${s(a.sliceList)} selection-mode=single selection-appearance=border @calciteListOrderChange=${this.onCalciteListOrderChange}>${this.buildGroupedSlicesListItem()}</calcite-list>`}onGroupingThresholdChange(e){let l=e.target.value,i=Number.parseInt(l);i>100?i=100:i<0&&(i=0),Number.isNaN(i)?this.model.setGroupingThreshold(0):(this.groupingThresholdElement?.value&&(this.groupingThresholdElement.value.value=i.toString()),this.model.setGroupingThreshold(i),this.groupingThresholdSliderElement.value&&(this.groupingThresholdSliderElement.value.value=i))}onLabelCharacterLimitChange(e){let l=e.target.value,i=Number.parseInt(l);i<1&&(i=1),Number.isNaN(i)?this.model.setLabelCharacterLimit(null):(this.labelCharacterLimitElement.value&&(this.labelCharacterLimitElement.value.value=i.toString()),this.model.setLabelCharacterLimit(i))}onDecimalPlacesChange(e){let l=e.target.value,i=Number.parseInt(l);i<0?i=0:i>20&&(i=20),Number.isNaN(i)?this.model.setDecimalPlaces(0):(this.decimalPlacesElement.value&&(this.decimalPlacesElement.value.value=i.toString()),this.model.setDecimalPlaces(i))}onDisplayTypeChange(e){let l=e.target.selectedItem;this.model.setDisplayType(l.value)}resetSlicesOriginal(){this.configSliceOpen=!1,this.selectedSliceId=void 0,this.model.setColorMatch(!0),this.model.resetSlices()}onCalciteListOrderChange(e){if(e.detail!==null&&e.detail!==void 0){let{newIndex:l,oldIndex:i}=e.detail;this.model.moveSeries(i,l)}}slicesPopoverChange(e){this.arcgisChartsConfigPieChartSlicesPopoverChange.emit({open:e,element:this.slicesPopover})}openSlicesPopover(e){let l=e.target,i=l.localName==="calcite-list-item"?l:l.parentNode,t=!this.configSliceOpen;this.configSliceOpen=this.selectedSliceId===i.value?t:!0,this.configSliceOpen?i.value===this.model.getSliceGrouping()?.sliceId?this.selectedSliceId=this.model.getSliceGrouping()?.sliceId:this.selectedSliceId=i.value:this.selectedSliceId=void 0}setupSlicesPopover(){if(this.slicesPopover===null&&this.el!==void 0){let e={referenceElement:this.el,placement:this.popoverPlacement,sliceNameChange:this.sliceNameChange,sliceColorChange:this.sliceColorChange,openChange:this.openChange,popoverClose:this.slicesPopoverClose};this.slicesPopover=w(M.PieChartSlicesPopover,e)}}addSlicesPopover(){this.slicesPopover!=null&&!document.body.contains(this.slicesPopover)&&document.body.appendChild(this.slicesPopover),this.slicesPopoverChange(!0)}createTooltip(e){let l=e.target;this.tooltip=O(l),this.tooltip.innerHTML=this._messages.groupingInfo??"",document.body.appendChild(this.tooltip)}destroyTooltip(){D(this.tooltip)}render(){return d`<div class=${s(a.sectionLabel)}>${this._messages.settings}</div><calcite-label class=${s(a.label)}>${this._messages.shape}<calcite-slider min=0 max=100 step=1 snap .value=${this.model.getInnerRadiusSize()??I} @calciteSliderChange=${this.onDonutSizeSliderChange} ${g(this.donutSizeSliderElement)}></calcite-slider></calcite-label><div class=${s(a.pieDonutLabelsContainer)}><calcite-label class=${s(a.label)}>${this._messages.pie}</calcite-label><calcite-label class=${s(a.label)}>${this._messages.donut}</calcite-label></div><calcite-label class=${s(a.label)}><div class=${s(a.groupingLabelContainer)}><div>${this._messages.groupingPercent}</div><calcite-icon icon=information scale=s flip-rtl @mouseover=${this.createTooltip} @mouseout=${this.destroyTooltip}></calcite-icon></div><div class=${s(a.sliderInputContainer)}><calcite-slider min=0 max=50 step=1 snap .value=${N(p(this.model.getGroupingThreshold()??0))} @calciteSliderChange=${this.onGroupingThresholdSliderChange} ${g(this.groupingThresholdSliderElement)}></calcite-slider><calcite-input class=${s(a.numberInput)} type=number min=0 max=100 step=1 suffix-text=% .value=${p(this.model.getGroupingThreshold()??0)} @calciteInputInput=${this.onGroupingThresholdChange} @click=${e=>{e.stopPropagation()}} ${g(this.groupingThresholdElement)}></calcite-input></div></calcite-label><div class=${s(a.sectionLabel)}>${this._messages.labels}</div><calcite-label class=${s(a.label)}>${this._messages.labelCharacterLimit}<calcite-input type=number min=1 step=1 .value=${p(this.model.getLabelCharacterLimit())} @calciteInputInput=${this.onLabelCharacterLimitChange} ${g(this.labelCharacterLimitElement)}></calcite-input></calcite-label><calcite-label class=${s(a.label)}>${this._messages.decimalPlaces}<calcite-input type=number min=0 max=20 step=1 .value=${p(this.model.getDecimalPlaces())} @calciteInputInput=${this.onDecimalPlacesChange} ${g(this.decimalPlacesElement)}></calcite-input></calcite-label><calcite-label class=${s(a.label)}>${this._messages.display}<calcite-radio-button-group class=${s(a.radioGroup)} name=display layout=vertical @calciteRadioButtonGroupChange=${this.onDisplayTypeChange}><calcite-label layout=inline><calcite-radio-button .value=${h.Value} .checked=${this.model.getDisplayType()===h.Value}></calcite-radio-button>${this._messages.value}</calcite-label><calcite-label layout=inline><calcite-radio-button .value=${h.Percentage} .checked=${this.model.getDisplayType()===h.Percentage}></calcite-radio-button>${this._messages.percentage}</calcite-label><calcite-label layout=inline><calcite-radio-button .value=${h.Both} .checked=${this.model.getDisplayType()===h.Both}></calcite-radio-button>${this._messages.both}</calcite-label></calcite-radio-button-group></calcite-label><div class=${s(a.sectionLabel)}>${this._messages.slices}<calcite-button @click=${this.resetSlicesOriginal} .disabled=${!this.model.resetAvailable()} appearance=transparent icon-end=reset>${this._messages.reset}</calcite-button></div>${this.buildSliceList()}<div class=${s(a.sectionLabel)}>${this._messages.groupedSlices}</div>${this.buildGroupedSliceList()}`}};E("arcgis-charts-config-pie-chart-slices",y);return y},"geometry/support/jsonUtils","rest/support/AttributeBinsQuery","rest/support/Query","rest/support/StatisticDefinition","time/TimeExtent","core/promiseUtils","request",a,b,c)