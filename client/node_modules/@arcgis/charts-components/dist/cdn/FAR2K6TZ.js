/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
v4.33.19 */
import b from"./UHUEI4NU.js";import a from"./PDDPZQ7S.js";import{c as g,d}from"./TJWJSZZ6.js";import{b as u,h as f,w as p}from"./IYCX42AE.js";export default $arcgis.t(([,,,,,,,{D:B,Na:P,Q:h,bb:x,m:T,n:q,tb:A,u:I,w:v,wa:V,z:N},{a:j,b:O,c:w,t:$}])=>{var E=i=>i.series?.[0]?.x??"";function K(i,t){let e=i.series?.[0];return[`${t===d.Category?e.y:q} ${f.Descending}`]}var R=(i,t)=>{let e=g.valueDesc,a=i.orderOptions?.data?.orderType??K(i,t),r=i.orderOptions?.data?.orderBy??f.Descending;return a===p.Category&&Array.isArray(r)?e=g.customSort:a===p.Category?r===f.Ascending?e=g.labelAsc:e=g.labelDesc:r===f.Ascending?e=g.valueAsc:e=g.valueDesc,e},m=I(i=>{let t=[];return t=i.series?.[0]?.query?.outStatistics?.map(e=>e.onStatisticField)??[i.series?.[0]?.y??""],[...new Set(t.filter(e=>e!==""))]},i=>i.series),C=(i,t)=>{let e=m(i),a;return t===d.Fields&&e.length===0?a=u.Sum:a=i.series?.[0]?.query?.outStatistics?.[0]?.statisticType??u.NoAggregation,a};async function W(i){let{config:t,layerInfo:e,mode:a}=i,{objectIdField:r}=e??{},n=await P(r),s=E(t),l=t.series[0]?.dataLabels?.visible??!1,o={...n,x:a===d.Category?s:T,slices:t.series?.[0]?.slices,dataLabels:{...n.dataLabels,visible:l},innerRadiusSize:t.series?.[0]?.innerRadius,sliceGrouping:t.series?.[0]?.sliceGrouping,dataLabelsCharacterLimit:t.series?.[0]?.dataLabelsCharacterLimit,numericValueFormat:t.series?.[0]?.numericValueFormat,percentValueFormat:t.series?.[0]?.percentValueFormat,displayCategoryOnDataLabel:t.series?.[0]?.displayCategoryOnDataLabel,displayNumericValueOnDataLabel:t.series?.[0]?.displayNumericValueOnDataLabel,displayPercentageOnDataLabel:t.series?.[0]?.displayPercentageOnDataLabel},c=C(t,a);if(c!==u.NoAggregation&&r!==void 0){let y=`${c}_${r}_0`.toUpperCase();o.y=a===d.Category?y:q,o.query={outStatistics:a===d.Category?[{statisticType:c,onStatisticField:r,outStatisticFieldName:y}]:[]}}return a===d.Category&&o.query!==void 0?o.query.groupByFieldsForStatistics=[s]:delete o.query?.groupByFieldsForStatistics,v(o)}async function D(i,t,e){let{layerFieldsInfo:a,objectIdField:r}=t,n=E(i),s=m(i),l=C(i,e),o=s.length===0||s.includes(r),c=await x(l),y=o?"":s.map(G=>A(a??[],G)).join(", "),F=A(a??[],n),b="",S=await j(),L;return e===d.Fields?L=s.length===0:L=n==="",L?b=S.chartType.pieChart:l===u.NoAggregation?b=h(S.titleLabels.aggrFieldsByCategory,{aggregationFields:o?r:y,category:F}):l===u.Count?b=h(S.titleLabels.aggrTypeCategory,{aggregationType:c,category:F}):s.length>0&&(F===T||N(F)||B(F)?b=h(S.titleLabels.aggrTypeOfAggrFields,{aggregationType:c,aggregationFields:y}):b=h(S.titleLabels.aggrTypeOfAggrFieldsByCategory,{aggregationType:c,aggregationFields:y,category:F})),b}var ie=i=>{let{newSortOrderKind:t,config:e,orderByList:a}=i;e.orderOptions??={},t===g.customSort&&a!==void 0?e.orderOptions.data={orderType:p.Category,orderBy:[...a]}:e.orderOptions.data={orderType:t===g.labelAsc||t===g.labelDesc?p.Category:p.YValue,orderBy:t===g.labelAsc||t===g.valueAsc?f.Ascending:f.Descending}},re=async i=>{let{newCategory:t,config:e,layerInfo:a,mode:r}=i,n=e.series?.length??0;if(e.series.forEach(s=>{s.x=r===d.Category?t:T,s.query!==void 0&&t!==T?s.query.groupByFieldsForStatistics=[t]:delete s.query?.groupByFieldsForStatistics}),n===0){let s=[await W({config:e,layerInfo:a,mode:r})];e.series=s}if(a!==void 0){let s=await w({config:e,layerInfo:a,numericFields:m(e),aggregationType:C(e,r)});O(e,1,s),e.title&&(e.title.content.text=await D(e,a,r));let l=r===d.Fields?m(e).filter(o=>o!==a.objectIdField):m(e);await Y({newNumericFields:l,config:e,layerInfo:a,mode:r})}};async function z(i){let{numericFields:t,aggregationType:e,config:a,layerInfo:r,mode:n}=i,s=[],l=await W({config:a,layerInfo:r,mode:n}),o={...l,query:{...l.query}};t.length<=1?o.query.where=l.query?.where:delete o.query.where;let c=$({config:a,numericFields:t,aggregationType:e,mode:n,layer:r.layer}).name;if(e!==u.NoAggregation)if(n===d.Category){if(t.length>0){let y=t[0];o.query.outStatistics=[{...l.query?.outStatistics?.[0]??{},onStatisticField:y,outStatisticFieldName:c,statisticType:e}]}}else for(let y of t)o.query.outStatistics?.push({onStatisticField:y,outStatisticFieldName:y,statisticType:e});else o.query={};o.y=c,s.push(o),a.series=s}var se=async i=>{let{newAggregationType:t,config:e,layerInfo:a,mode:r}=i,n=m(e);await z({config:e,layerInfo:a,numericFields:n,aggregationType:t,mode:r});let s=await w({config:e,layerInfo:a,numericFields:m(e),aggregationType:C(e,r)});O(e,1,s),e.title&&(e.title.content.text=await D(e,a,r));let l=e.series?.[0]?.displayCategoryOnDataLabel,o=e.series?.[0]?.displayNumericValueOnDataLabel,c=e.series?.[0]?.displayPercentageOnDataLabel;e.legend={...e.legend??V(),displayNumericValue:o,displayPercentage:c,displayCategory:l}},Y=async i=>{let{newNumericFields:t}=i,{config:e,layerInfo:a,mode:r}=i,{objectIdField:n}=a??{},s=C(e,r);if(t=t===""?[]:t,t=typeof t=="string"?[t]:t,n!==void 0&&(t.length===0&&r===d.Category?(t.push(n),s=u.Count):s===u.Count&&t.length>=1&&!t.includes(n)&&(s=u.Sum)),a!==void 0){await z({config:e,layerInfo:a,numericFields:t,aggregationType:s,mode:r});let l=await w({config:e,layerInfo:a,numericFields:m(e),aggregationType:C(e,r)});O(e,1,l),e.title&&(e.title.content.text=await D(e,a,r))}else e.series.forEach(l=>{delete l.query,l.y=t[0]})},oe=(i,t)=>{let e=[],a=i.orderOptions?.data?.orderType,r=R(i,t),n=i.orderOptions?.data?.orderBy;return r===g.customSort&&a===p.Category&&Array.isArray(n)&&(e=n),e},ne=i=>{let{values:t,config:e,mode:a}=i;e.orderOptions??={};let r=e.orderOptions?.data?.orderType;R(e,a)===g.customSort&&r===p.Category&&(e.orderOptions.data={orderType:p.Category,orderBy:[...t]})};return{a:E,b:R,c:m,d:C,e:ie,f:re,g:se,h:Y,i:oe,j:ne}},"geometry/support/jsonUtils","rest/support/AttributeBinsQuery","rest/support/Query","rest/support/StatisticDefinition","time/TimeExtent","core/promiseUtils","request",a,b)