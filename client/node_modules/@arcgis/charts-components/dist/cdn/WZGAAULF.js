/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
v4.33.19 */
import b from"./3RODMSQG.js";import{d as c}from"./ITSRCSFZ.js";import a from"./PDDPZQ7S.js";import{E as v,c as C,d as h,n as d,z as u}from"./MDSKC43G.js";import"./IYCX42AE.js";import"./YG7SBKS5.js";export default $arcgis.t(([,,,,,,,{A:n,Gc:I,Ic:F,h:y,w:p},{g:S}])=>{var w=C`:host{overflow-y:auto;overflow-x:hidden;margin-bottom:var(--arcgis-charts-intra-section-margin);margin-top:var(--arcgis-charts-intra-section-margin);height:100%}`,g=class extends u{constructor(){super(...arguments),this.popoverElement=null,this.onModelConfigChange=async e=>{let i=e?.detail.config??this.model.getConfig();this.layer===void 0&&await this.updateFetchLayerFieldsInfo(i)},this.popoverPlacement="leading",this.arcgisChartsConfigNoSeriesUpdate=d(),this.arcgisChartsConfigWebChartChange=d()}static{this.properties={layerFieldsInfo:16,model:0,popoverPlacement:3,seriesColor:2,calculatedMinMaxBounds:2,page:3,layer:0,usePopupTemplateFieldsInfo:5,filterBySelection:5,chartData:0}}static{this.styles=w}async load(){this.layer!==void 0&&await this.layerChange(this.layer,void 0),this.seriesColor!==void 0&&this.seriesColorChange(this.seriesColor),this.usePopupTemplateFieldsInfo!==void 0&&await this.usePopupTemplateFieldsInfoChange(this.usePopupTemplateFieldsInfo,void 0),this.modelChange(this.model),this.onModelConfigChange()}async willUpdate(e){e.has("model")&&this.modelChange(this.model,e.get("model")),e.has("layer")&&await this.layerChange(this.layer,e.get("layer")),e.has("usePopupTemplateFieldsInfo")&&await this.usePopupTemplateFieldsInfoChange(this.usePopupTemplateFieldsInfo,e.get("usePopupTemplateFieldsInfo")),e.has("seriesColor")&&this.seriesColorChange(this.seriesColor),this.layerFieldsInfo===void 0&&await this.updateFetchLayerFieldsInfo()}disconnectedCallback(){super.disconnectedCallback(),this.model.removeEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)}modelChange(e,i){i?.removeEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange),e?.addEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)}async layerChange(e,i){e!==void 0&&!n(i,e)&&await this.updateFetchLayerFieldsInfo()}async usePopupTemplateFieldsInfoChange(e,i){e!==void 0&&e!==i&&await this.updateFetchLayerFieldsInfo()}seriesColorChange(e){let{slices:i,groupedSlices:t,groupOfSlices:a}=e?.get(0)??{},o=[];this.filterBySelection===!0?o=this.model.getSlices()?.map(r=>i?.find(s=>s.sliceId===r.sliceId)??t?.find(s=>s.sliceId===r.sliceId)??r)??[]:o=(i??[]).concat(t??[]),o.forEach((r,s)=>{let f=this.model.getSlices()?.find(P=>P.sliceId===o[s].sliceId);f&&(o[s]={...o[s],...f});let l=o[s].fillSymbol;l!==void 0&&!n(l?.outline?.color,l?.color)&&(l.outline={...l.outline??{},type:y.SLS,color:l.color})});let m=(t??[]).map(r=>r.sliceId);t!==void 0&&!n(m,this.model.getGroupedSliceIds())&&this.model.setGroupedSliceIds(p(m)),n(o,this.model.getSlices())||this.model.setSlices(p(o)),a!==void 0&&!n(a,this.model.getSliceGrouping())&&this.model.setSliceGrouping(p(a))}async updateFetchLayerFieldsInfo(e){let i=e??this.model.getConfig(),t=this.layer;if(!t){let a=S(i)?i.iLayer:void 0;a&&(t=await I(a))}t&&(this.layerFieldsInfo=await F(t,this.usePopupTemplateFieldsInfo))}popoverOpen(e){let{open:i=!1,element:t=null}={...e.detail};i===!0&&this.popoverElement!==t?(this.popoverElement!==null&&(this.popoverElement.open=!1),this.popoverElement=t):i===!1&&this.popoverElement===t&&(this.popoverElement=null)}render(){let e;switch(this.page){case c.Data:e=h`<arcgis-charts-config-pie-chart-data .model=${this.model} .layerFieldsInfo=${this.layerFieldsInfo}></arcgis-charts-config-pie-chart-data>`;break;case c.Slices:e=h`<arcgis-charts-config-pie-chart-slices .model=${this.model} .chartData=${this.chartData} @arcgisChartsConfigPieChartSlicesPopoverChange=${this.popoverOpen} .popoverPlacement=${this.popoverPlacement}></arcgis-charts-config-pie-chart-slices>`;break;case c.Format:e=h`<arcgis-charts-config-format .model=${this.model} @arcgisChartsConfigFormatPopoverChange=${this.popoverOpen}></arcgis-charts-config-format>`;break;case c.General:e=h`<arcgis-charts-config-general .model=${this.model}></arcgis-charts-config-general>`;break;default:e="";break}return e}};v("arcgis-charts-config-pie-chart",g);return g},"geometry/support/jsonUtils","rest/support/AttributeBinsQuery","rest/support/Query","rest/support/StatisticDefinition","time/TimeExtent","core/promiseUtils","request",a,b)