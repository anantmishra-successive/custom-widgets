System.register(["jimu-core/react","jimu-arcgis","esri/widgets/Sketch/SketchViewModel","esri/layers/GraphicsLayer","esri/geometry/geometryEngine","esri/geometry/Polygon","esri/Graphic","esri/geometry/Extent"],function(e,t){var a={},r={},n={},o={},i={},s={},l={},c={};return{setters:[function(e){a.default=e.default,a.useEffect=e.useEffect,a.useRef=e.useRef,a.useState=e.useState},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent},function(e){n.default=e.default},function(e){o.default=e.default},function(e){i.buffer=e.buffer,i.geodesicArea=e.geodesicArea},function(e){s.default=e.default},function(e){l.default=e.default},function(e){c.default=e.default}],execute:function(){e((()=>{var e={56:(e,t,a)=>{"use strict";e.exports=function(e){var t=a.nc;t&&e.setAttribute("nonce",t)}},72:e=>{"use strict";var t=[];function a(e){for(var a=-1,r=0;r<t.length;r++)if(t[r].identifier===e){a=r;break}return a}function r(e,r){for(var o={},i=[],s=0;s<e.length;s++){var l=e[s],c=r.base?l[0]+r.base:l[0],d=o[c]||0,u="".concat(c," ").concat(d);o[c]=d+1;var f=a(u),m={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==f)t[f].references++,t[f].updater(m);else{var g=n(m,r);r.byIndex=s,t.splice(s,0,{identifier:u,updater:g,references:1})}i.push(u)}return i}function n(e,t){var a=t.domAPI(t);a.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;a.update(e=t)}else a.remove()}}e.exports=function(e,n){var o=r(e=e||[],n=n||{});return function(e){e=e||[];for(var i=0;i<o.length;i++){var s=a(o[i]);t[s].references--}for(var l=r(e,n),c=0;c<o.length;c++){var d=a(o[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}o=l}}},113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var a="",r=void 0!==t[5];return t[4]&&(a+="@supports (".concat(t[4],") {")),t[2]&&(a+="@media ".concat(t[2]," {")),r&&(a+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),a+=e(t),r&&(a+="}"),t[2]&&(a+="}"),t[4]&&(a+="}"),a}).join("")},t.i=function(e,a,r,n,o){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(r)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(i[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);r&&i[d[0]]||(void 0!==o&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=o),a&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=a):d[2]=a),n&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=n):d[4]="".concat(n)),t.push(d))}},t}},420:e=>{"use strict";e.exports=c},470:e=>{"use strict";e.exports=l},526:e=>{"use strict";e.exports=s},540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{"use strict";e.exports=function(e){return e[1]}},620:e=>{"use strict";e.exports=o},624:e=>{"use strict";e.exports=n},655:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var r=a(601),n=a.n(r),o=a(314),i=a.n(o)()(n());i.push([e.id,".offline-map-area-widget{padding:1rem;background-color:#fff;border-radius:.5rem;box-shadow:0 1px 3px rgba(0, 0, 0, 0.1);border:1px solid #e5e7eb;max-width:24rem;margin-left:auto;margin-right:auto}.flex-container{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem}.back-button{display:flex;align-items:center;color:#4b5563;font-size:.875rem;transition:color .2s ease}.back-button:hover{color:#1f2937}.icon{width:1rem;height:1rem;margin-right:.25rem;fill:none;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}.widget-title{font-size:1.125rem;font-weight:600;color:#111827}.spinner{display:flex;align-items:center;justify-content:center;padding-top:2rem;padding-bottom:2rem}.spinner-circle{animation:spin 1s linear infinite;border-radius:9999px;height:2rem;width:2rem;border:2px solid transparent;border-bottom-color:#2563eb}@keyframes spin{to{transform:rotate(360deg)}}.error-container{margin-bottom:1rem;padding:.75rem;background-color:#fef2f2;border:1px solid #fee2e2;border-radius:.375rem}.error-text{color:#dc2626;font-size:.875rem}.error-close-button{color:#f87171;transition:color .2s ease}.error-close-button:hover{color:#dc2626}.select-label{display:block;font-size:.875rem;font-weight:500;color:#374151;margin-bottom:.25rem}.select-input{width:100%;padding:.5rem .75rem;border:1px solid #d1d5db;border-radius:.375rem;font-size:.875rem;outline:none;transition:border-color .2s ease,box-shadow .2s ease}.select-input:focus{border-color:transparent;box-shadow:0 0 0 2px #3b82f6}.area-list{margin-bottom:1rem;max-height:16rem;overflow-y:auto;space-y:.5rem}.area-item{display:flex;align-items:center;justify-content:space-between;padding:.75rem;background-color:#f9fafb;border-radius:.375rem}.area-title{font-size:.875rem;font-weight:500;color:#111827;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.area-details{font-size:.75rem;color:#6b7280}.no-areas-text{color:#6b7280;font-size:.875rem;text-align:center;padding-top:1rem;padding-bottom:1rem}.action-button{padding:.25rem;transition:color .2s ease}.action-button.view{color:#2563eb}.action-button.view:hover{color:#1e40af}.action-button.remove{color:#f87171}.action-button.remove:hover{color:#dc2626}.btn-primary{flex:1;background-color:#2563eb;color:#fff;padding:.5rem 1rem;border-radius:.375rem;font-size:.875rem;font-weight:500;text-align:center;transition:background-color .2s ease}.btn-primary:hover{background-color:#1e40af}.btn-primary:disabled{background-color:#d1d5db;cursor:not-allowed}.btn-secondary{padding:.5rem .75rem;color:#4b5563;border:1px solid #d1d5db;border-radius:.375rem;font-size:.875rem;font-weight:500;transition:background-color .2s ease,color .2s ease}.btn-secondary:hover{background-color:#f3f4f6}.btn-secondary.red{color:#dc2626;border-color:#fee2e2}.btn-secondary.red:hover{background-color:#fef2f2}.package-list{space-y:.5rem;max-height:16rem;overflow-y:auto}.package-item{padding:.75rem;background-color:#f9fafb;border-radius:.375rem}.package-title{font-size:.875rem;font-weight:500;color:#111827;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.package-details{font-size:.75rem;color:#6b7280}.package-status{display:inline-block;padding:.25rem .5rem;font-size:.75rem;border-radius:9999px;margin-top:.25rem}.package-status.ready{background-color:#dcfce7;color:#15803d}.package-status.processing{background-color:#fefce8;color:#a16207}.package-status.other{background-color:#f3f4f6;color:#374151}.refresh-button{padding:.5rem;color:#2563eb;transition:color .2s ease}.refresh-button:hover{color:#1e40af}.refresh-button:disabled{opacity:.5}.input-field{width:100%;padding:.5rem .75rem;border:1px solid #d1d5db;border-radius:.375rem;font-size:.875rem;outline:none;transition:border-color .2s ease,box-shadow .2s ease}.input-field:focus{border-color:transparent;box-shadow:0 0 0 2px #3b82f6}.draw-mode-button{flex:1;padding:.5rem .75rem;border-radius:.375rem;font-size:.875rem;font-weight:500;transition:background-color .2s ease,color .2s ease}.draw-mode-button.active{background-color:#2563eb;color:#fff}.draw-mode-button.inactive{background-color:#f3f4f6;color:#374151}.draw-mode-button.inactive:hover{background-color:#e5e7eb}.draw-mode-button:disabled{background-color:#d1d5db;color:#6b7280;cursor:not-allowed}.notification-container{padding:.75rem;border-radius:.375rem}.notification-container.yellow{background-color:#fefce8;border:1px solid #fef08a}.notification-container.green{background-color:#dcfce7;border:1px solid #86efac}.notification-container.blue{background-color:#eff6ff;border:1px solid #bfdbfe}.notification-text{font-size:.875rem}.notification-text.yellow{color:#854d0e}.notification-text.green{color:#15803d}.notification-text.blue{color:#1e40af}.flex-gap-2{display:flex;gap:.5rem}.flex-gap-1{display:flex;gap:.25rem}",""]);const s=i},659:e=>{"use strict";var t={};e.exports=function(e,a){var r=function(e){if(void 0===t[e]){var a=document.querySelector(e);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(e){a=null}t[e]=a}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(a)}},686:e=>{"use strict";e.exports=r},825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(a){!function(e,t,a){var r="";a.supports&&(r+="@supports (".concat(a.supports,") {")),a.media&&(r+="@media ".concat(a.media," {"));var n=void 0!==a.layer;n&&(r+="@layer".concat(a.layer.length>0?" ".concat(a.layer):""," {")),r+=a.css,n&&(r+="}"),a.media&&(r+="}"),a.supports&&(r+="}");var o=a.sourceMap;o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,a)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},958:e=>{"use strict";e.exports=i},972:e=>{"use strict";e.exports=a}},t={};function d(a){var r=t[a];if(void 0!==r)return r.exports;var n=t[a]={id:a,exports:{}};return e[a](n,n.exports,d),n.exports}d.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return d.d(t,{a:t}),t},d.d=(e,t)=>{for(var a in t)d.o(t,a)&&!d.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.p="",d.nc=void 0;var u={};return d.p=window.jimuConfig.baseUrl,(()=>{"use strict";d.r(u),d.d(u,{__set_webpack_public_path__:()=>A,default:()=>j});var e=d(972),t=d(686),a=d(624),r=d(620),n=d(958),o=d(526),i=d(470),s=d(420),l=d(72),c=d.n(l),f=d(825),m=d.n(f),g=d(659),p=d.n(g),b=d(56),v=d.n(b),y=d(540),h=d.n(y),w=d(113),k=d.n(w),x=d(655),E={};E.styleTagTransform=k(),E.setAttributes=v(),E.insert=p().bind(null,"head"),E.domAPI=m(),E.insertStyleElement=h();c()(x.A,E);x.A&&x.A.locals&&x.A.locals;var M=function(e,t,a,r){return new(a||(a=Promise))(function(n,o){function i(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(i,s)}l((r=r.apply(e,t||[])).next())})};class N{constructor(e="https://frontiergis.maps.arcgis.com",t=""){this.baseUrl=e,this.token=t}setToken(e){this.token=e}getOfflineAreas(e){return M(this,void 0,void 0,function*(){const t=`${this.baseUrl}/sharing/rest/content/items/${e}/relatedItems`,a=new URLSearchParams({relationshipType:"Map2Area",token:this.token,f:"json"});try{const e=yield fetch(`${t}?${a}`),r=yield e.json();return r.relatedItems?r.relatedItems.map(e=>{var t;return{id:e.id,name:e.title,title:e.title,geometry:e.extent||e.geometry||null,created:new Date(e.created),owner:e.owner,type:e.type,numViews:e.numViews,size:e.size,packages:[],status:null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.status}}):[]}catch(e){throw console.error("[v0] Error fetching offline areas:",e),e}})}getAreaPackages(e){return M(this,void 0,void 0,function*(){const t=`${this.baseUrl}/sharing/rest/content/items/${e}/relatedItems`,a=new URLSearchParams({relationshipType:"Area2Package",direction:"forward",token:this.token,f:"json"});try{const e=yield fetch(`${t}?${a}`),r=yield e.json();return console.log("areaaaaas packages",r.relatedItems),r.relatedItems?r.relatedItems.map(e=>{var t;return{id:e.id,title:(null===(t=e.title.match(/^[^-]*/))||void 0===t?void 0:t[0])||e.title,type:e.type,created:new Date(e.created),size:e.size}}):[]}catch(e){throw console.error("[v0] Error fetching area packages:",e),e}})}refreshPackage(e){return M(this,void 0,void 0,function*(){const t=new FormData;t.append("f","json"),t.append("token",this.token),t.append("packages",JSON.stringify([{itemId:e}]));try{const e=yield fetch("https://packaging.arcgis.com/arcgis/rest/services/OfflinePackaging/GPServer/RefreshMapAreaPackage/submitJob",{method:"POST",body:t});return yield e.json()}catch(e){throw console.error("[v0] Error refreshing package:",e),e}})}getWebMapData(e){return M(this,void 0,void 0,function*(){const t=`${this.baseUrl}/sharing/rest/content/items/${e}/data`,a=new URLSearchParams({f:"json",token:this.token});try{const e=yield fetch(`${t}?${a}`);return yield e.json()}catch(e){throw console.error("[v0] Error fetching web map data:",e),e}})}createMapAreaJob(e,t,a,r){return M(this,void 0,void 0,function*(){const n=new FormData;n.append("f","json"),n.append("token",this.token),n.append("mapItemId",e),n.append("area",JSON.stringify(t)),n.append("areaType",a),n.append("outputName",JSON.stringify({title:r,folderId:"",packageRefreshSchedule:""}));try{const e=yield fetch("https://packaging.arcgis.com/arcgis/rest/services/OfflinePackaging/GPServer/CreateMapArea/submitJob",{method:"POST",body:n}),t=yield e.json();if(t.jobId)return t.jobId;throw new Error("Failed to submit create map area job: "+JSON.stringify(t))}catch(e){throw console.error("[v0] Error submitting create map area job:",e),e}})}getJobStatus(e,t){return M(this,void 0,void 0,function*(){const a=`https://packaging.arcgis.com/arcgis/rest/services/OfflinePackaging/GPServer/${e}/jobs/${t}`,r=new URLSearchParams({f:"json",token:this.token,returnMessages:"true",_:Date.now().toString()});try{const e=yield fetch(`${a}?${r}`);return yield e.json()}catch(e){throw console.error("[v0] Error getting job status:",e),e}})}pollJobStatus(e,t){return M(this,void 0,void 0,function*(){let a="esriJobExecuting";for(;"esriJobSubmitted"===a||"esriJobExecuting"===a||"esriJobWaiting"===a;){const r=yield this.getJobStatus(e,t);if(a=r.jobStatus,"esriJobFailed"===a)throw new Error(`Job failed: ${JSON.stringify(r.messages)}`);if("esriJobSucceeded"===a)return r;yield new Promise(e=>setTimeout(e,2e3))}throw new Error(`Unexpected job status: ${a}`)})}getMapAreaItemId(e){return M(this,void 0,void 0,function*(){const t=`https://packaging.arcgis.com/arcgis/rest/services/OfflinePackaging/GPServer/CreateMapArea/jobs/${e}/results/mapAreaItemId`,a=new URLSearchParams({f:"json",token:this.token,_:Date.now().toString()});try{const e=yield fetch(`${t}?${a}`);return(yield e.json()).value}catch(e){throw console.error("[v0] Error getting map area item ID:",e),e}})}setupMapAreaJob(e,t,a){return M(this,void 0,void 0,function*(){const r=new FormData;r.append("f","json"),r.append("token",this.token),r.append("mapAreaItemId",e),r.append("featureServices",JSON.stringify(t)),r.append("tileServices",JSON.stringify(a));try{const e=yield fetch("https://packaging.arcgis.com/arcgis/rest/services/OfflinePackaging/GPServer/SetupMapArea/submitJob",{method:"POST",body:r}),t=yield e.json();if(t.jobId)return t.jobId;throw new Error("Failed to submit setup map area job: "+JSON.stringify(t))}catch(e){throw console.error("[v0] Error submitting setup map area job:",e),e}})}}function j({config:l,useMapWidgetIds:c}){var d,u;const[f,m]=(0,e.useState)({currentView:"list",offlineAreas:[],selectedMapId:null,selectedMapTitle:null,selectedAreaId:null,selectedAreaPackages:[],loading:!1,errorMessage:null,drawingMode:null,drawnGeometry:null,areaName:"",createdAreas:[],isMapReady:!1}),g=(0,e.useRef)(new N(l.baseUrl||"https://frontiergis.maps.arcgis.com",l.apiToken||"")),p=(0,e.useRef)(null),b=(0,e.useRef)(null);(0,e.useEffect)(()=>()=>{var e;if(b.current&&(null===(e=p.current)||void 0===e?void 0:e.view)){const e=p.current.view.map.layers.find(e=>"Sketch Layer"===e.title);e&&p.current.view.map.remove(e)}},[]);const v=(e,t)=>M(this,void 0,void 0,function*(){m(e=>Object.assign(Object.assign({},e),{loading:!0,errorMessage:null}));try{const a=yield g.current.getOfflineAreas(e);l.enableOffline&&a.forEach(e=>{const a=t.find(t=>t.id===e.id);a&&console.log(`Synced layer ${a.id} with offline area ${e.title}`)}),m(e=>Object.assign(Object.assign({},e),{offlineAreas:a,loading:!1}))}catch(e){console.error("[v0] Error loading offline areas:",e),m(e=>Object.assign(Object.assign({},e),{loading:!1,errorMessage:"Failed to load offline areas from API. Using demo data."})),y()}}),y=()=>{const e=[{id:"area-1",name:"Downtown Area",title:"Downtown Area",geometry:[[-118.25,34.05],[-118.24,34.06]],created:new Date("2024-01-15"),owner:"demo",type:"Map Area",packages:[]},{id:"area-2",name:"Harbor District",title:"Harbor District",geometry:{rings:[[[-118.27,34.04],[-118.26,34.05],[-118.25,34.04],[-118.27,34.04]]],spatialReference:{wkid:4326}},created:new Date("2024-01-10"),owner:"demo",type:"Map Area",packages:[]}];m(t=>Object.assign(Object.assign({},t),{offlineAreas:e,loading:!1,selectedMapId:"demo-map-1",selectedMapTitle:"Demo Web Map"}))},h=e=>M(this,void 0,void 0,function*(){const t=f.offlineAreas.find(t=>t.id===e);m(t=>Object.assign(Object.assign({},t),{loading:!0,errorMessage:null,selectedAreaId:e,currentView:"packages"}));try{const a=yield g.current.getAreaPackages(e);if(m(e=>Object.assign(Object.assign({},e),{selectedAreaPackages:a,loading:!1})),p.current&&(null==t?void 0:t.geometry)){let e=null;if(Array.isArray(t.geometry)&&2===t.geometry.length){const[[a,r],[n,o]]=t.geometry;e=new s.default({xmin:a,ymin:r,xmax:n,ymax:o,spatialReference:{wkid:4326}})}else if(t.geometry.rings){e=o.default.fromJSON(t.geometry).extent}e&&p.current.view.goTo(e.expand(1.2))}}catch(e){console.error("[v0] Error loading area packages:",e);const a=[{id:"package-1",title:"Mobile Map Package",type:"Mobile Map Package",created:new Date("2024-01-15"),size:256e5,status:"ready"},{id:"package-2",title:"Tile Package",type:"Tile Package",created:new Date("2024-01-14"),size:154e5,status:"processing"}];if(m(e=>Object.assign(Object.assign({},e),{selectedAreaPackages:a,loading:!1,errorMessage:"Failed to load packages from API. Showing demo data."})),p.current&&(null==t?void 0:t.geometry)){let e=null;if(Array.isArray(t.geometry)&&2===t.geometry.length){const[[a,r],[n,o]]=t.geometry;e=new s.default({xmin:a,ymin:r,xmax:n,ymax:o,spatialReference:{wkid:4326}})}else if(t.geometry.rings){e=o.default.fromJSON(t.geometry).extent}e&&p.current.view.goTo(e.expand(1.2))}}}),w=e=>M(this,void 0,void 0,function*(){m(e=>Object.assign(Object.assign({},e),{loading:!0,errorMessage:null}));try{const t=yield g.current.refreshPackage(e);console.log("[v0] Package refresh result:",t),f.selectedAreaId&&(yield h(f.selectedAreaId)),m(e=>Object.assign(Object.assign({},e),{loading:!1}))}catch(e){console.error("[v0] Error refreshing package:",e),m(e=>Object.assign(Object.assign({},e),{loading:!1,errorMessage:"Failed to refresh package. Please try again."}))}}),k=e=>{p.current&&b.current?f.drawnGeometry?m(e=>Object.assign(Object.assign({},e),{errorMessage:"A geometry is already drawn. Please clear it before starting a new drawing."})):(b.current.create(e),m(t=>Object.assign(Object.assign({},t),{drawingMode:e,errorMessage:null}))):m(e=>Object.assign(Object.assign({},e),{errorMessage:"Map is not loaded or drawing tools are not initialized. Please ensure a map widget is selected."}))},x=()=>{if(m(e=>Object.assign(Object.assign({},e),{currentView:"list",errorMessage:null,areaName:"",drawnGeometry:null,drawingMode:null,selectedAreaId:null})),p.current){const e=p.current.view.map.layers.find(e=>"Sketch Layer"===e.title);e&&e.removeAll(),b.current&&(b.current.cancel(),b.current.activeTool=null)}};return(0,e.useEffect)(()=>{if(!p.current||!f.isMapReady||0===f.offlineAreas.length)return;const e=p.current.view.map.layers.find(e=>"Offline Areas Layer"===e.title)||new r.default({id:"offline-areas-layer",title:"Offline Areas Layer"});p.current.view.map.layers.includes(e)||p.current.view.map.add(e),e.removeAll(),f.offlineAreas.forEach(t=>{var a,r;if(!t.geometry)return void console.warn("[v0] Skipping area with no geometry:",t.title);let n=null,s=!1;if(Array.isArray(t.geometry)&&2===t.geometry.length){const[[e,a],[r,i]]=t.geometry;n=new o.default({rings:[[[e,a],[r,a],[r,i],[e,i],[e,a]]],spatialReference:{wkid:4326}}),s=!1}else t.geometry.rings&&(n=o.default.fromJSON(t.geometry),s=4===(null===(r=null===(a=n.rings)||void 0===a?void 0:a[0])||void 0===r?void 0:r.length));n&&e.add(new i.default({geometry:n,symbol:s?{type:"simple-fill",color:[255,165,0,.1],outline:{color:[255,165,0,1],width:1},style:"solid"}:{type:"simple-fill",color:[255,0,0,.1],outline:{color:[255,0,0,1],width:1},style:"solid"}}))})},[f.offlineAreas,f.isMapReady]),e.default.createElement(e.default.Fragment,null,e.default.createElement(t.JimuMapViewComponent,{useMapWidgetId:null==c?void 0:c[0],onActiveViewChange:e=>{var t;if(e&&e.view&&e.view.map&&(null===(t=e.view.map.portalItem)||void 0===t?void 0:t.id)){p.current=e;const t=e.view.map.portalItem.id,o=e.view.map.portalItem.title||"Current Web Map",s=e.view.map.layers.find(e=>"Sketch Layer"===e.title)||new r.default({id:"sketch-layer",title:"Sketch Layer"});e.view.map.layers.includes(s)||e.view.map.add(s),b.current=new a.default({view:e.view,layer:s,polygonSymbol:{type:"simple-fill",color:[51,153,255,.3],outline:{color:[51,153,255,1],width:2}},updateOnGraphicClick:!1}),b.current.on("create",e=>{var t,a;if("complete"===e.state){let r=e.graphic.geometry;l.enableOffline&&l.offlineBuffer&&(r=n.buffer(r,l.offlineBuffer,"meters"));const o="polygon"===r.type&&4===(null===(a=null===(t=r.rings)||void 0===t?void 0:t[0])||void 0===a?void 0:a.length);s.removeAll(),s.add(new i.default({geometry:r,symbol:o?{type:"simple-fill",color:[255,165,0,.3],outline:{color:[255,165,0,1],width:2}}:{type:"simple-fill",color:[51,153,255,.3],outline:{color:[51,153,255,1],width:2}}})),b.current.cancel(),m(e=>Object.assign(Object.assign({},e),{drawnGeometry:r.toJSON(),drawingMode:null}))}}),m(e=>Object.assign(Object.assign({},e),{isMapReady:!0,selectedMapId:t,selectedMapTitle:o})),v(t,e.view.map.layers)}else m(e=>Object.assign(Object.assign({},e),{isMapReady:!1,errorMessage:"Map widget not found or no valid map ID. Using demo mode.",selectedMapId:"demo-map-1",selectedMapTitle:"Demo Web Map"})),y()}}),"packages"===f.currentView?e.default.createElement("div",{className:"offline-map-area-widget"},e.default.createElement("div",{className:"flex-container"},e.default.createElement("button",{onClick:x,className:"back-button"},e.default.createElement("svg",{className:"icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e.default.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})),"Back"),e.default.createElement("h2",{className:"widget-title"},"Packages")),f.offlineAreas.find(e=>e.id===f.selectedAreaId)&&e.default.createElement("div",{className:"area-item"},e.default.createElement("p",{className:"area-title"},null===(d=f.offlineAreas.find(e=>e.id===f.selectedAreaId))||void 0===d?void 0:d.title),e.default.createElement("p",{className:"area-details"},"Created: ",null===(u=f.offlineAreas.find(e=>e.id===f.selectedAreaId))||void 0===u?void 0:u.created.toLocaleDateString())),f.errorMessage&&e.default.createElement("div",{className:"error-container"},e.default.createElement("div",{className:"flex-container"},e.default.createElement("p",{className:"error-text"},f.errorMessage),e.default.createElement("button",{onClick:()=>m(e=>Object.assign(Object.assign({},e),{errorMessage:null})),className:"error-close-button"},e.default.createElement("svg",{className:"icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e.default.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}))))),f.loading?e.default.createElement("div",{className:"spinner"},e.default.createElement("div",{className:"spinner-circle"})):e.default.createElement("div",{className:"package-list"},0===f.selectedAreaPackages.length?e.default.createElement("p",{className:"no-areas-text"},"No packages found for this area"):f.selectedAreaPackages.map(t=>e.default.createElement("div",{key:t.id,className:"package-item"},e.default.createElement("div",{className:"flex-container"},e.default.createElement("div",{className:"flex-1 min-w-0"},e.default.createElement("p",{className:"package-title"},t.title),e.default.createElement("p",{className:"package-details"},t.type," \u2022 ",t.created.toLocaleDateString(),t.size&&` \u2022 ${(t.size/1024/1024).toFixed(1)} MB`)),e.default.createElement("button",{onClick:()=>w(t.id),disabled:f.loading,className:"refresh-button",title:"Refresh package"},e.default.createElement("svg",{className:"icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e.default.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})))))))):"list"===f.currentView?e.default.createElement("div",{className:"offline-map-area-widget"},e.default.createElement("div",{className:"flex-container"},e.default.createElement("h2",{className:"widget-title"},"Offline Areas")),f.selectedMapTitle&&e.default.createElement("div",{className:"mb-4"},e.default.createElement("p",{className:"select-label"},"Current Map: ",f.selectedMapTitle)),f.errorMessage&&e.default.createElement("div",{className:"error-container"},e.default.createElement("div",{className:"flex-container"},e.default.createElement("p",{className:"error-text"},f.errorMessage),e.default.createElement("button",{onClick:()=>m(e=>Object.assign(Object.assign({},e),{errorMessage:null})),className:"error-close-button"},e.default.createElement("svg",{className:"icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e.default.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}))))),f.loading?e.default.createElement("div",{className:"spinner"},e.default.createElement("div",{className:"spinner-circle"})):e.default.createElement(e.default.Fragment,null,e.default.createElement("div",{className:"area-list"},0===f.offlineAreas.length?e.default.createElement("p",{className:"no-areas-text"},"No offline areas created yet"):f.offlineAreas.map(t=>e.default.createElement("div",{key:t.id,className:"area-item"},e.default.createElement("div",{className:"flex-1 min-w-0"},e.default.createElement("p",{className:"area-title"},t.title),e.default.createElement("p",{className:"area-details"},"Created: ",t.created.toLocaleDateString()," \u2022 Owner: ",t.owner)),e.default.createElement("div",{className:"flex-gap-1"},"complete"===t.status?null:e.default.createElement("button",{disabled:!0,className:"action-button status "+("failed"===t.status?"bg-red-500":"bg-green-500"),title:`Status: ${t.status}`},"failed"===t.status?"Failed":"Packaging"),e.default.createElement("button",{onClick:()=>h(t.id),className:"action-button view",title:"View packages"},e.default.createElement("svg",{className:"icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e.default.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"}))),e.default.createElement("button",{onClick:()=>{return e=t.id,void m(t=>Object.assign(Object.assign({},t),{createdAreas:t.createdAreas.filter(t=>t.id!==e),offlineAreas:t.offlineAreas.filter(t=>t.id!==e),selectedAreaId:t.selectedAreaId===e?null:t.selectedAreaId}));var e},className:"action-button remove",title:"Remove area"},e.default.createElement("svg",{className:"icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e.default.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"}))))))),e.default.createElement("div",{className:"flex-gap-2"},e.default.createElement("button",{onClick:()=>{m(e=>Object.assign(Object.assign({},e),{currentView:"create",errorMessage:null,areaName:"",drawnGeometry:null,drawingMode:null}))},className:"btn-primary"},"Create New Area"),f.offlineAreas.length>0&&e.default.createElement("button",{onClick:()=>m(e=>Object.assign(Object.assign({},e),{createdAreas:[],offlineAreas:[],selectedAreaId:null})),className:"btn-secondary red",title:"Clear all areas"},"Clear All")))):e.default.createElement("div",{className:"offline-map-area-widget"},e.default.createElement("div",{className:"flex-container"},e.default.createElement("button",{onClick:x,className:"back-button"},e.default.createElement("svg",{className:"icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e.default.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})),"Back"),e.default.createElement("h2",{className:"widget-title"},"Create Offline Area")),f.errorMessage&&e.default.createElement("div",{className:"error-container"},e.default.createElement("div",{className:"flex-container"},e.default.createElement("p",{className:"error-text"},f.errorMessage),e.default.createElement("button",{onClick:()=>m(e=>Object.assign(Object.assign({},e),{errorMessage:null})),className:"error-close-button"},e.default.createElement("svg",{className:"icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e.default.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}))))),!f.isMapReady&&e.default.createElement("div",{className:"notification-container yellow"},e.default.createElement("p",{className:"notification-text yellow"},"Loading map, please wait...")),e.default.createElement("div",{className:"space-y-4"},e.default.createElement("div",null,e.default.createElement("label",{htmlFor:"areaName",className:"select-label"},"Area Name"),e.default.createElement("input",{type:"text",id:"areaName",value:f.areaName,onChange:e=>m(t=>Object.assign(Object.assign({},t),{areaName:e.target.value})),placeholder:"Enter a name for your area",className:"input-field"})),f.selectedMapTitle&&e.default.createElement("div",null,e.default.createElement("p",{className:"select-label"},"Current Map: ",f.selectedMapTitle)),e.default.createElement("div",null,e.default.createElement("label",{className:"select-label"},"Select Draw Mode"),e.default.createElement("div",{className:"flex-gap-2"},e.default.createElement("button",{onClick:()=>k("polygon"),disabled:"polygon"===f.drawingMode||!f.isMapReady||f.drawnGeometry,className:"draw-mode-button "+("polygon"===f.drawingMode?"active":f.isMapReady&&!f.drawnGeometry?"inactive":"")},"\u25cf Polygon"),e.default.createElement("button",{onClick:()=>k("rectangle"),disabled:"rectangle"===f.drawingMode||!f.isMapReady||f.drawnGeometry,className:"draw-mode-button "+("rectangle"===f.drawingMode?"active":f.isMapReady&&!f.drawnGeometry?"inactive":"")},"\u25a0 Rectangle"),e.default.createElement("button",{onClick:()=>{var e;if(b.current){b.current.cancel(),b.current.activeTool=null;const t=null===(e=p.current)||void 0===e?void 0:e.view.map.layers.find(e=>"Sketch Layer"===e.title);t&&t.removeAll()}m(e=>Object.assign(Object.assign({},e),{drawingMode:null,drawnGeometry:null,errorMessage:null}))},disabled:!f.drawnGeometry&&!f.drawingMode,className:"btn-secondary"},"Clear"))),f.drawingMode&&e.default.createElement("div",{className:"notification-container yellow"},e.default.createElement("p",{className:"notification-text yellow"},"Drawing ",f.drawingMode," mode active. Draw on the map to create your offline area.")),f.drawnGeometry&&e.default.createElement("div",{className:"notification-container green"},e.default.createElement("p",{className:"notification-text green"},"\u2713 Geometry created successfully. Click Save to create the offline area or Clear to start over.")),f.createdAreas.length>0&&e.default.createElement("div",{className:"notification-container blue"},e.default.createElement("p",{className:"notification-text blue"},f.createdAreas.length," area(s) created in this session. All areas will be preserved.")),e.default.createElement("div",{className:"flex-gap-2 pt-2"},e.default.createElement("button",{onClick:()=>M(this,void 0,void 0,function*(){var e,t;if(f.areaName.trim())if(f.drawnGeometry)if((e=>{if(!e||!e.rings&&!e.xmin)return console.error("[v0] Invalid geometry: missing rings or extent properties"),!1;try{let t;t=e.rings?new o.default({rings:e.rings,spatialReference:e.spatialReference}):new o.default({rings:[[[e.xmin,e.ymin],[e.xmax,e.ymin],[e.xmax,e.ymax],[e.xmin,e.ymax],[e.xmin,e.ymin]]],spatialReference:e.spatialReference||{wkid:102100,latestWkid:3857}});const a=n.geodesicArea(t,"square-kilometers");return!(a<=0||a>1e4)||(console.error("[v0] Invalid geometry: area is too large or invalid",{area:a}),!1)}catch(e){return console.error("[v0] Error validating geometry:",e),!1}})(f.drawnGeometry)){m(e=>Object.assign(Object.assign({},e),{loading:!0,errorMessage:null}));try{const a=f.selectedMapId;if(!a)throw new Error("No map selected");const r=f.drawnGeometry,n=r.rings?"POLYGON":"ENVELOPE",o=Object.assign({spatialReference:r.spatialReference||{wkid:102100,latestWkid:3857}},"POLYGON"===n?{rings:r.rings}:{xmin:r.xmin,ymin:r.ymin,xmax:r.xmax,ymax:r.ymax}),i=yield g.current.createMapAreaJob(a,o,n,f.areaName.trim()),s=(yield g.current.pollJobStatus("CreateMapArea",i),yield g.current.getMapAreaItemId(i)),l=yield g.current.getWebMapData(a),c=l.tables||[],d=new Map,u=new Map;for(const e of c)if(e.url&&e.url.includes("FeatureServer")){const t=e.url.split("/");let a=t.pop()||"";const r=parseInt(a,10),n=!isNaN(r)?t.join("/"):e.url;d.set(n,(d.get(n)||0)+1),u.set(`${n}/${r}`,{layerId:r,query:{queryOption:"all"}})}let b="",y=0;for(const[e,t]of d)t>y&&(y=t,b=e);if(!b)throw new Error("No valid FeatureServer URLs found in web map data");const h=[],w={};for(const[e,{layerId:t,query:a}]of u)h.push(t),w[t]=a;const k=[{url:b,layers:h.sort((e,t)=>e-t),returnAttachments:!1,attachmentsSyncDirection:"upload",syncModel:"perLayer",createPkgDeltas:{maxDeltaAge:5},layerQueries:w}],x=((null===(e=l.baseMap)||void 0===e?void 0:e.baseMapLayers)||[]).filter(e=>{var t,a;return"ArcGISTiledMapServiceLayer"===e.layerType&&e.url||"VectorTileLayer"===e.layerType||(null===(t=e.url)||void 0===t?void 0:t.includes("MapServer"))||(null===(a=e.url)||void 0===a?void 0:a.includes("VectorTileServer"))}).map(e=>({url:"VectorTileLayer"===e.layerType?"https://basemaps.arcgis.com/arcgis/rest/services/World_Basemap_v2/VectorTileServer":e.url,levels:Array.from({length:22},(e,t)=>t).join(",")})).filter(e=>e.url);console.log("tileServices:",JSON.stringify(x,null,2)),yield g.current.setupMapAreaJob(s,k,x);const E={id:s,name:f.areaName.trim(),title:f.areaName.trim(),geometry:f.drawnGeometry,created:new Date,owner:"current_user",type:"Map Area",packages:[]};if(m(e=>Object.assign(Object.assign({},e),{createdAreas:[...e.createdAreas,E],offlineAreas:[...e.offlineAreas,E],loading:!1,currentView:"list",areaName:"",drawnGeometry:null,drawingMode:null})),yield v(a,null===(t=p.current)||void 0===t?void 0:t.view.map.layers),console.log("[v0] Offline area created successfully:",E),p.current){const e=p.current.view.map.layers.find(e=>"Sketch Layer"===e.title);e&&e.removeAll()}}catch(e){console.error("[v0] Error saving offline area:",e),m(e=>Object.assign(Object.assign({},e),{loading:!1,errorMessage:"Failed to save offline area. Please try again."}))}}else m(e=>Object.assign(Object.assign({},e),{errorMessage:"Invalid geometry. Please ensure the area is valid and not too large."}));else m(e=>Object.assign(Object.assign({},e),{errorMessage:"Please draw an area on the map first"}));else m(e=>Object.assign(Object.assign({},e),{errorMessage:"Please enter a name for the offline area"}))}),disabled:!f.drawnGeometry||!f.areaName.trim()||f.loading,className:"btn-primary"},f.loading?e.default.createElement("span",{className:"flex items-center justify-center"},e.default.createElement("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."):"Save"),e.default.createElement("button",{onClick:x,className:"btn-secondary"},"Cancel")))))}function A(e){d.p=e}})(),u})())}}});